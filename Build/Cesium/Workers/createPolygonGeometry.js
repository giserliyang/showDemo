define(["./when-d186add7","./Rectangle-f841217d","./ArcType-198c1070","./arrayFill-deb10550","./BoundingRectangle-1d700ce8","./buildModuleUrl-d920237a","./Cartesian2-2b41fabe","./Cartographic-1d953166","./Check-2514d21d","./ComponentDatatype-07894a2b","./EllipsoidGeodesic-fc4b25bd","./EllipsoidTangentPlane-e12285fe","./GeometryAttribute-95780fd1","./GeometryInstance-2076821b","./GeometryOffsetAttribute-da5a1d35","./GeometryPipeline-6f0b08bc","./IndexDatatype-61ffec74","./Math-7f5f2992","./FeatureDetection-4281d393","./PolygonGeometryLibrary-190f4e75","./PolygonPipeline-6809c3ce","./VertexFormat-769ac289","./Event-50568704","./RuntimeError-4a74cd1a","./WebGLConstants-8d1e45f7","./Cartesian4-3408960c","./IntersectionTests-300d4352","./Plane-d9914d3c","./AttributeCompression-16430ee7","./EncodedCartesian3-e527b85b","./arrayRemoveDuplicates-74caa2f4","./EllipsoidRhumbLine-394d2834","./GeometryAttributes-9c67dd14"],(function(t,e,o,r,i,n,a,s,l,u,p,c,d,g,h,y,m,f,v,_,b,T,w,I,x,A,P,E,C,O,H,D,N){"use strict";var L=new s.t$1,R=new s.t$1;function F(t,e,o,r){var i=r.cartesianToCartographic(t,L).height,n=r.cartesianToCartographic(e,R);n.height=i,r.cartographicToCartesian(n,e);var a=r.cartesianToCartographic(o,R);a.height=i-100,r.cartographicToCartesian(a,o)}var G=new i.f,B=new s.t,S=new s.t,V=new s.t,k=new s.t,z=new s.t,W=new s.t,M=new s.t,U=new s.t,Y=new s.t,j=new a.o,$=new a.o,q=new s.t,K=new d.n,Q=new v.p,Z=new v.p;function J(e){var o=e.vertexFormat,i=e.geometry,n=e.shadowVolume,l=i.attributes.position.values,p=l.length,c=e.wall,g=e.top,y=e.bottom;if(o.st||o.normal||o.tangent||o.bitangent||n){var m=e.boundingRectangle,_=e.tangentPlane,b=e.ellipsoid,T=e.stRotation,w=e.perPositionHeight,I=j;I.x=m.x,I.y=m.y;var x,A=e.isComputeTexCoord?new Float32Array(p):new Float32Array(p/3*2),P=o.st?A:void 0;o.normal&&(x=w&&g&&!c?i.attributes.normal.values:new Float32Array(p));var E=o.tangent?new Float32Array(p):void 0,C=o.bitangent?new Float32Array(p):void 0,O=n?new Float32Array(p):void 0,H=0,D=0,N=S,L=V,R=k,G=!0,J=Q,X=Z;if(0!==T){var tt=d.n.fromAxisAngle(_._plane.normal,T,K);J=v.p.fromQuaternion(tt,J),tt=d.n.fromAxisAngle(_._plane.normal,-T,K),X=v.p.fromQuaternion(tt,X)}else J=v.p.clone(v.p.IDENTITY,J),X=v.p.clone(v.p.IDENTITY,X);var et=0;(g&&y||c)&&(et=p/2,p/=2);var ot=1,rt=[];if(o.st&&c&&e.isComputeTexCoord){let t=[...e.outerPositions,e.outerPositions[0]];for(let e=1;e<t.length;e++){ot+=s.t.distance(t[e-1],t[e]),rt.push(ot)}}for(var it=0;it<p;it+=3){var nt=s.t.fromArray(l,it,q);if(o.st){var at=v.p.multiplyByVector(J,nt,B);at=b.scaleToGeodeticSurface(at,at);var st=_.projectPointOntoPlane(at,$);a.o.subtract(st,I,st);var lt=f.e.clamp(st.x/m.width,0,1),ut=f.e.clamp(st.y/m.height,0,1);if(c&&ot>1){let t=Math.ceil(it/6)-1;lt=rt[t]?rt[t]/ot:0,P[H]=1-lt,P[H+1]=1,P[H+2]=0,P[H+et]=1-lt,P[H+1+et]=0,P[H+2+et]=0}y&&(P[H+et]=lt,P[H+1+et]=ut,e.isComputeTexCoord&&(P[H+2+et]=-1)),g&&(P[H]=lt,P[H+1]=ut,e.isComputeTexCoord&&(P[H+2]=1)),e.isComputeTexCoord?H+=3:H+=2}if(o.normal||o.tangent||o.bitangent||n){var pt=D+1,ct=D+2;if(c){if(it+3<p){var dt=s.t.fromArray(l,it+3,z);if(G){var gt=s.t.fromArray(l,it+p,W);w&&F(nt,dt,gt,b),s.t.subtract(dt,nt,dt),s.t.subtract(gt,nt,gt),N=s.t.normalize(s.t.cross(gt,dt,N),N),G=!1}s.t.equalsEpsilon(dt,nt,f.e.EPSILON10)&&(G=!0)}(o.tangent||o.bitangent)&&(R=b.geodeticSurfaceNormal(nt,R),o.tangent&&(L=s.t.normalize(s.t.cross(R,N,L),L)))}else N=b.geodeticSurfaceNormal(nt,N),(o.tangent||o.bitangent)&&(w&&(M=s.t.fromArray(x,D,M),U=s.t.cross(s.t.UNIT_Z,M,U),U=s.t.normalize(v.p.multiplyByVector(X,U,U),U),o.bitangent&&(Y=s.t.normalize(s.t.cross(M,U,Y),Y))),L=s.t.cross(s.t.UNIT_Z,N,L),L=s.t.normalize(v.p.multiplyByVector(X,L,L),L),o.bitangent&&(R=s.t.normalize(s.t.cross(N,L,R),R)));o.normal&&(e.wall?(x[D+et]=N.x,x[pt+et]=N.y,x[ct+et]=N.z):y&&(x[D+et]=-N.x,x[pt+et]=-N.y,x[ct+et]=-N.z),(g&&!w||c)&&(x[D]=N.x,x[pt]=N.y,x[ct]=N.z)),n&&(c&&(N=b.geodeticSurfaceNormal(nt,N)),O[D+et]=-N.x,O[pt+et]=-N.y,O[ct+et]=-N.z),o.tangent&&(e.wall?(E[D+et]=L.x,E[pt+et]=L.y,E[ct+et]=L.z):y&&(E[D+et]=-L.x,E[pt+et]=-L.y,E[ct+et]=-L.z),g&&(w?(E[D]=U.x,E[pt]=U.y,E[ct]=U.z):(E[D]=L.x,E[pt]=L.y,E[ct]=L.z))),o.bitangent&&(y&&(C[D+et]=R.x,C[pt+et]=R.y,C[ct+et]=R.z),g&&(w?(C[D]=Y.x,C[pt]=Y.y,C[ct]=Y.z):(C[D]=R.x,C[pt]=R.y,C[ct]=R.z))),D+=3}}o.st&&(i.attributes.st=new d.o({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:e.isComputeTexCoord?3:2,values:P})),o.normal&&(i.attributes.normal=new d.o({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:x})),o.tangent&&(i.attributes.tangent=new d.o({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:E})),o.bitangent&&(i.attributes.bitangent=new d.o({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:C})),n&&(i.attributes.extrudeDirection=new d.o({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:O}))}if(e.extrude&&t.e(e.offsetAttribute)){var ht=l.length/3,yt=new Uint8Array(ht);if(e.offsetAttribute===h.z.TOP)g&&y||c?yt=r.d(yt,1,0,ht/2):g&&(yt=r.d(yt,1));else{var mt=e.offsetAttribute===h.z.NONE?0:1;yt=r.d(yt,mt)}i.attributes.applyOffset=new d.o({componentDatatype:u.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:yt})}return i}var X=new s.t$1,tt=new s.t$1;const et={westOverIDL:0,eastOverIDL:0};var ot=new p.E;function rt(r,i,n,a,s){if(s=t.u(s,new e.h),!t.e(r)||r.length<3)return s.west=0,s.north=0,s.south=0,s.east=0,s;if(n===o.L.RHUMB)return e.h.fromCartesianArray(r,i,s);ot.ellipsoid.equals(i)||(ot=new p.E(void 0,void 0,i)),s.west=Number.POSITIVE_INFINITY,s.east=Number.NEGATIVE_INFINITY,s.south=Number.POSITIVE_INFINITY,s.north=Number.NEGATIVE_INFINITY,et.westOverIDL=Number.POSITIVE_INFINITY,et.eastOverIDL=Number.NEGATIVE_INFINITY;for(var l,u=1/f.e.chordLength(a,i.maximumRadius),c=r.length,d=i.cartesianToCartographic(r[0],tt),g=X,h=1;h<c;h++)l=g,g=d,d=i.cartesianToCartographic(r[h],l),ot.setEndPoints(g,d),nt(ot,u,s,et);return l=g,g=d,d=i.cartesianToCartographic(r[0],l),ot.setEndPoints(g,d),nt(ot,u,s,et),s.east-s.west>et.eastOverIDL-et.westOverIDL&&(s.west=et.westOverIDL,s.east=et.eastOverIDL,s.east>f.e.PI&&(s.east=s.east-f.e.TWO_PI),s.west>f.e.PI&&(s.west=s.west-f.e.TWO_PI)),s}var it=new s.t$1;function nt(t,e,o,r){for(var i=t.surfaceDistance,n=Math.ceil(i*e),a=n>0?i/(n-1):Number.POSITIVE_INFINITY,s=0,l=0;l<n;l++){var u=t.interpolateUsingSurfaceDistance(s,it);s+=a;var p=u.longitude,c=u.latitude;o.west=Math.min(o.west,p),o.east=Math.max(o.east,p),o.south=Math.min(o.south,c),o.north=Math.max(o.north,c);const e=p>=0?p:p+f.e.TWO_PI;r.westOverIDL=Math.min(r.westOverIDL,e),r.eastOverIDL=Math.max(r.eastOverIDL,e)}}var at=[];function st(t,e,o,r,i,n,a,s,l,u,p){var d,h={walls:[]};if(n||a){var y,f,v=_.y.createGeometryFromPositions(t,e,o,i,s,l),T=v.attributes.position.values,w=v.indices;if(n&&a){var I=T.concat(T);y=I.length/3,(f=m.IndexDatatype.createTypedArray(y,2*w.length)).set(w);var x=w.length,A=y/2;for(d=0;d<x;d+=3){var P=f[d]+A,E=f[d+1]+A,C=f[d+2]+A;f[d+x]=C,f[d+1+x]=E,f[d+2+x]=P}if(v.attributes.position.values=I,i&&s.normal){var O=v.attributes.normal.values;v.attributes.normal.values=new Float32Array(I.length),v.attributes.normal.values.set(O)}v.indices=f}else if(a){for(y=T.length/3,f=m.IndexDatatype.createTypedArray(y,w.length),d=0;d<w.length;d+=3)f[d]=w[d+2],f[d+1]=w[d+1],f[d+2]=w[d];v.indices=f}h.topAndBottom=new g.d({geometry:v})}var H,D=r.outerRing,N=c.f.fromPoints(D,t),L=N.projectPointsOntoPlane(D,at),R=b.A.computeWindingOrder2D(L);R===b.W.CLOCKWISE&&(D=D.slice().reverse()),u&&(H=_.y.computeWallGeometry(D,t,o,i,l,p),h.walls.push(new g.d({geometry:H})));var F=r.holes;for(d=0;d<F.length;d++){var G=F[d];L=(N=c.f.fromPoints(G,t)).projectPointsOntoPlane(G,at),(R=b.A.computeWindingOrder2D(L))===b.W.COUNTER_CLOCKWISE&&(G=G.slice().reverse()),H=_.y.computeWallGeometry(G,t,o,i,l),h.walls.push(new g.d({geometry:H}))}return h}function lt(r){if(l.o.typeOf.object("options",r),l.o.typeOf.object("options.polygonHierarchy",r.polygonHierarchy),t.e(r.perPositionHeight)&&r.perPositionHeight&&t.e(r.height))throw new l.t("Cannot use both options.perPositionHeight and options.height");if(t.e(r.arcType)&&r.arcType!==o.L.GEODESIC&&r.arcType!==o.L.RHUMB)throw new l.t("Invalid arcType. Valid options are ArcType.GEODESIC and ArcType.RHUMB.");var i=r.polygonHierarchy,n=t.u(r.vertexFormat,T.n.DEFAULT),a=t.u(r.ellipsoid,e.t.WGS84),s=t.u(r.granularity,f.e.RADIANS_PER_DEGREE),u=t.u(r.stRotation,0),p=t.u(r.perPositionHeight,!1),c=p&&t.e(r.extrudedHeight),d=t.u(r.height,0),g=t.u(r.extrudedHeight,d);if(!c){var h=Math.max(d,g);g=Math.min(d,g),d=h}this._vertexFormat=T.n.clone(n),this._ellipsoid=e.t.clone(a),this._granularity=s,this._stRotation=u,this._height=d,this._extrudedHeight=g,this._closeTop=t.u(r.closeTop,!0),this._closeBottom=t.u(r.closeBottom,!0),this._extrudeOutering=t.u(r.extrudeOutering,!0),this._polygonHierarchy=i,this._perPositionHeight=p,this._perPositionHeightExtrude=c,this._shadowVolume=t.u(r.shadowVolume,!1),this._workerName="createPolygonGeometry",this._offsetAttribute=r.offsetAttribute,this._arcType=t.u(r.arcType,o.L.GEODESIC),this._groundBottomAltitude=t.u(r.groundBottomAltitude,0),this._groundExtrudedHeight=t.u(r.groundExtrudedHeight,0),this._rectangle=void 0,this._textureCoordinateRotationPoints=void 0,this._isComputeTexCoord=r.isComputeTexCoord,this._isWall=t.u(r.isWall,!1),this.packedLength=_.y.computeHierarchyPackedLength(i)+e.t.packedLength+T.n.packedLength+12}lt.fromPositions=function(e){return e=t.u(e,t.u.EMPTY_OBJECT),l.o.defined("options.positions",e.positions),new lt({polygonHierarchy:{positions:e.positions},height:e.height,extrudedHeight:e.extrudedHeight,vertexFormat:e.vertexFormat,stRotation:e.stRotation,ellipsoid:e.ellipsoid,granularity:e.granularity,perPositionHeight:e.perPositionHeight,closeTop:e.closeTop,closeBottom:e.closeBottom,offsetAttribute:e.offsetAttribute,arcType:e.arcType,isComputeTexCoord:e.isComputeTexCoord,isWall:e.isWall})},lt.pack=function(o,r,i){return l.o.typeOf.object("value",o),l.o.defined("array",r),i=t.u(i,0),i=_.y.packPolygonHierarchy(o._polygonHierarchy,r,i),e.t.pack(o._ellipsoid,r,i),i+=e.t.packedLength,T.n.pack(o._vertexFormat,r,i),i+=T.n.packedLength,r[i++]=o._height,r[i++]=o._extrudedHeight,r[i++]=o._granularity,r[i++]=o._stRotation,r[i++]=o._perPositionHeightExtrude?1:0,r[i++]=o._perPositionHeight?1:0,r[i++]=o._closeTop?1:0,r[i++]=o._closeBottom?1:0,r[i++]=o._shadowVolume?1:0,r[i++]=t.u(o._offsetAttribute,-1),r[i++]=o._arcType,r[i]=o.packedLength,r};var ut=e.t.clone(e.t.UNIT_SPHERE),pt=new T.n,ct={polygonHierarchy:{}};return lt.unpack=function(o,r,i){l.o.defined("array",o),r=t.u(r,0);var n=_.y.unpackPolygonHierarchy(o,r);r=n.startingIndex,delete n.startingIndex;var a=e.t.unpack(o,r,ut);r+=e.t.packedLength;var s=T.n.unpack(o,r,pt);r+=T.n.packedLength;var u=o[r++],p=o[r++],c=o[r++],d=o[r++],g=1===o[r++],h=1===o[r++],y=1===o[r++],m=1===o[r++],f=1===o[r++],v=o[r++],b=o[r++],w=o[r];return t.e(i)||(i=new lt(ct)),i._polygonHierarchy=n,i._ellipsoid=e.t.clone(a,i._ellipsoid),i._vertexFormat=T.n.clone(s,i._vertexFormat),i._height=u,i._extrudedHeight=p,i._granularity=c,i._stRotation=d,i._perPositionHeightExtrude=g,i._perPositionHeight=h,i._closeTop=y,i._closeBottom=m,i._shadowVolume=f,i._offsetAttribute=-1===v?void 0:v,i._arcType=b,i.packedLength=w,i},lt.computeRectangle=function(r,i){l.o.typeOf.object("options",r),l.o.typeOf.object("options.polygonHierarchy",r.polygonHierarchy);var n=t.u(r.granularity,f.e.RADIANS_PER_DEGREE),a=t.u(r.arcType,o.L.GEODESIC);if(a!==o.L.GEODESIC&&a!==o.L.RHUMB)throw new l.t("Invalid arcType. Valid options are ArcType.GEODESIC and ArcType.RHUMB.");var s=r.polygonHierarchy,u=t.u(r.ellipsoid,e.t.WGS84);return rt(s.positions,u,a,n,i)},lt.createGeometry=function(e){var o=e._vertexFormat,i=e._ellipsoid,a=e._granularity,s=e._stRotation,l=e._polygonHierarchy,p=e._perPositionHeight,v=e._closeTop,T=e._closeBottom,w=e._arcType,I=l.positions;if(!(I.length<3)){var x=c.f.fromPoints(I,i),A=_.y.polygonsFromHierarchy(l,x.projectPointsOntoPlane.bind(x),!p,i),P=A.hierarchy,E=A.polygons;if(0!==P.length){I=P[0].outerRing;var C,O=_.y.computeBoundingRectangle(x.plane.normal,x.projectPointOntoPlane.bind(x),I,s,G),H=[],D=e._height,N=e._extrudedHeight,L=e._perPositionHeightExtrude||!f.e.equalsEpsilon(D,N,0,f.e.EPSILON2),R={perPositionHeight:p,vertexFormat:o,geometry:void 0,tangentPlane:x,boundingRectangle:O,ellipsoid:i,stRotation:s,bottom:!1,top:!0,wall:!1,extrude:!1,arcType:w,outerPositions:I,isComputeTexCoord:e._isComputeTexCoord};if(L)for(R.extrude=!0,R.top=v,R.bottom=T,R.shadowVolume=e._shadowVolume,R.offsetAttribute=e._offsetAttribute,C=0;C<E.length;C++){var F,B=st(i,E[C],a,P[C],p,v,T,o,w,e._extrudeOutering,e._isWall);v&&T?(F=B.topAndBottom,R.geometry=_.y.scaleToGeodeticHeightExtruded(F.geometry,D,N,i,p)):v?((F=B.topAndBottom).geometry.attributes.position.values=b.A.scaleToGeodeticHeight(F.geometry.attributes.position.values,D,i,!p),R.geometry=F.geometry):T&&((F=B.topAndBottom).geometry.attributes.position.values=b.A.scaleToGeodeticHeight(F.geometry.attributes.position.values,N,i,!0),R.geometry=F.geometry),(v||T)&&(R.wall=!1,F.geometry=J(R),H.push(F));var S=B.walls;R.wall=!0;for(var V=0;V<S.length;V++){var k=S[V];R.top=!1,R.bottom=!1,R.geometry=_.y.scaleToGeodeticHeightExtruded(k.geometry,D,N,i,p),k.geometry=J(R),H.push(k)}}else for(C=0;C<E.length;C++){var z=new g.d({geometry:_.y.createGeometryFromPositions(i,E[C],a,p,o,w)});if(z.geometry.attributes.position.values=b.A.scaleToGeodeticHeight(z.geometry.attributes.position.values,D,i,!p),R.geometry=z.geometry,z.geometry=J(R),t.e(e._offsetAttribute)){var W=z.geometry.attributes.position.values.length,M=new Uint8Array(W/3),U=e._offsetAttribute===h.z.NONE?0:1;r.d(M,U),z.geometry.attributes.applyOffset=new d.o({componentDatatype:u.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:M})}H.push(z)}var Y=y.k.combineInstances(H)[0];Y.attributes.position.values=new Float64Array(Y.attributes.position.values),Y.indices=m.IndexDatatype.createTypedArray(Y.attributes.position.values.length/3,Y.indices);var j=Y.attributes,$=n.i.fromVertices(j.position.values);return o.position||delete j.position,new d.I({attributes:j,indices:Y.indices,primitiveType:Y.primitiveType,boundingSphere:$,offsetAttribute:e._offsetAttribute})}}},lt.createShadowVolume=function(t,e,o){var r=t._granularity,i=t._ellipsoid,n=t._groundBottomAltitude+t._groundExtrudedHeight,a=t._groundBottomAltitude?t._groundBottomAltitude:e(r,i),s=n!==t._groundBottomAltitude?n:o(r,i);return new lt({polygonHierarchy:t._polygonHierarchy,ellipsoid:i,stRotation:t._stRotation,granularity:r,perPositionHeight:!1,extrudedHeight:a,height:s,vertexFormat:T.n.POSITION_ONLY,shadowVolume:!0,arcType:t._arcType})},Object.defineProperties(lt.prototype,{rectangle:{get:function(){if(!t.e(this._rectangle)){var e=this._polygonHierarchy.positions;this._rectangle=rt(e,this._ellipsoid,this._arcType,this._granularity)}return this._rectangle}},textureCoordinateRotationPoints:{get:function(){return t.e(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(t){var e=-t._stRotation;if(0===e)return[0,0,0,1,1,0];var o=t._ellipsoid,r=t._polygonHierarchy.positions,i=t.rectangle;return d.I._textureCoordinateRotationPoints(r,e,o,i)}(this)),this._textureCoordinateRotationPoints}}}),function(o,r){return t.e(r)&&(o=lt.unpack(o,r)),o._ellipsoid=e.t.clone(o._ellipsoid),lt.createGeometry(o)}}));
