define(["./buildModuleUrl-d920237a","./Cartesian2-2b41fabe","./Cartographic-1d953166","./Check-2514d21d","./when-d186add7","./Rectangle-f841217d","./GeographicTilingScheme-27838d11","./ArcType-198c1070","./arrayRemoveDuplicates-74caa2f4","./ComponentDatatype-07894a2b","./EllipsoidGeodesic-fc4b25bd","./EllipsoidRhumbLine-394d2834","./EncodedCartesian3-e527b85b","./GeometryAttribute-95780fd1","./IntersectionTests-300d4352","./Math-7f5f2992","./FeatureDetection-4281d393","./Plane-d9914d3c","./WebMercatorProjection-af624514","./Event-50568704","./RuntimeError-4a74cd1a","./WebGLConstants-8d1e45f7","./Cartesian4-3408960c"],(function(t,e,n,a,r,i,o,s,l,c,u,p,d,h,g,f,w,m,v,y,E,T,_){"use strict";var I=new n.t,O=new n.t,k=new n.t$1,P=new n.t,S=new n.t,L=new t.i,b=new o.g,x=[new n.t$1,new n.t$1,new n.t$1,new n.t$1],A=new e.o,C={};function N(t){n.t$1.fromRadians(t.east,t.north,0,x[0]),n.t$1.fromRadians(t.west,t.north,0,x[1]),n.t$1.fromRadians(t.east,t.south,0,x[2]),n.t$1.fromRadians(t.west,t.south,0,x[3]);var e,a=0,r=0,i=0,o=0,s=C._terrainHeightsMaxLevel;for(e=0;e<=s;++e){for(var l=!1,c=0;c<4;++c){var u=x[c];if(b.positionToTileXY(u,e,A),0===c)i=A.x,o=A.y;else if(i!==A.x||o!==A.y){l=!0;break}}if(l)break;a=i,r=o}if(0!==e)return{x:a,y:r,level:e>s?s:e-1}}C.initialize=function(){var e=C._initPromise;return r.e(e)||(e=t.t.fetchJson(t.n$1("Assets/approximateTerrainHeights.json")).then((function(t){C._terrainHeights=t})),C._initPromise=e),e},C.getMinimumMaximumHeights=function(t,e){if(a.o.defined("rectangle",t),!r.e(C._terrainHeights))throw new a.t("You must call ApproximateTerrainHeights.initialize and wait for the promise to resolve before using this function");e=r.u(e,i.t.WGS84);var o=N(t),s=C._defaultMinTerrainHeight,l=C._defaultMaxTerrainHeight;if(r.e(o)){var c=o.level+"-"+o.x+"-"+o.y,u=C._terrainHeights[c];r.e(u)&&(s=u[0],l=u[1]),e.cartographicToCartesian(i.h.northeast(t,k),I),e.cartographicToCartesian(i.h.southwest(t,k),O),n.t.midpoint(O,I,P);var p=e.scaleToGeodeticSurface(P,S);if(r.e(p)){var d=n.t.distance(P,p);s=Math.min(s,-d)}else s=C._defaultMinTerrainHeight}return{minimumTerrainHeight:s=Math.max(C._defaultMinTerrainHeight,s),maximumTerrainHeight:l}},C.getBoundingSphere=function(e,n){if(a.o.defined("rectangle",e),!r.e(C._terrainHeights))throw new a.t("You must call ApproximateTerrainHeights.initialize and wait for the promise to resolve before using this function");n=r.u(n,i.t.WGS84);var o=N(e),s=C._defaultMaxTerrainHeight;if(r.e(o)){var l=o.level+"-"+o.x+"-"+o.y,c=C._terrainHeights[l];r.e(c)&&(s=c[1])}var u=t.i.fromRectangle3D(e,n,0);return t.i.fromRectangle3D(e,n,s,L),t.i.union(u,L,u)},C._terrainHeightsMaxLevel=6,C._defaultMaxTerrainHeight=9e3,C._defaultMinTerrainHeight=-1e5,C._terrainHeights=void 0,C._initPromise=void 0,Object.defineProperties(C,{initialized:{get:function(){return r.e(C._terrainHeights)}}});var D=[t.n,v.t],H=D.length,M=Math.cos(f.e.toRadians(30)),z=Math.cos(f.e.toRadians(150));function R(t){var e=(t=r.u(t,r.u.EMPTY_OBJECT)).positions;if(!r.e(e)||e.length<2)throw new a.t("At least two positions are required.");if(r.e(t.arcType)&&t.arcType!==s.L.GEODESIC&&t.arcType!==s.L.RHUMB)throw new a.t("Valid options for arcType are ArcType.GEODESIC and ArcType.RHUMB.");this.width=r.u(t.width,1),this._positions=e,this.granularity=r.u(t.granularity,9999),this.loop=r.u(t.loop,!1),this.arcType=r.u(t.arcType,s.L.GEODESIC),this._ellipsoid=r.u(t.ellipsoid,i.t.WGS84),this._projectionIndex=0,this._workerName="createGroundPolylineGeometry",this._scene3DOnly=!1}Object.defineProperties(R.prototype,{packedLength:{get:function(){return 1+3*this._positions.length+1+1+1+i.t.packedLength+1+1}}}),R.setProjectionAndEllipsoid=function(t,e){for(var n=0,a=0;a<H;a++)if(e instanceof D[a]){n=a;break}t._projectionIndex=n,t._ellipsoid=e.ellipsoid};var $=new n.t,j=new n.t,F=new n.t;function G(t,e,a,r,i){var o=Z(r,t,0,$),s=Z(r,t,a,j),l=Z(r,e,0,F),c=X(s,o,j),u=X(l,o,F);return n.t.cross(u,c,i),n.t.normalize(i,i)}var B=new n.t$1,q=new n.t,U=new n.t,W=new n.t;function Y(t,e,a,r,i,o,l,c,d,h,g){if(0!==i){var f;o===s.L.GEODESIC?f=new u.E(t,e,l):o===s.L.RHUMB&&(f=new p.P(t,e,l));var w=f.surfaceDistance;if(!(w<i))for(var m=G(t,e,r,l,W),v=Math.ceil(w/i),y=w/v,E=y,T=v-1,_=c.length,I=0;I<T;I++){var O=f.interpolateUsingSurfaceDistance(E,B),k=Z(l,O,a,q),P=Z(l,O,r,U);n.t.pack(m,c,_),n.t.pack(k,d,_),n.t.pack(P,h,_),g.push(O.latitude),g.push(O.longitude),_+=3,E+=y}}}var V=new n.t$1;function Z(t,e,a,r){return n.t$1.clone(e,V),V.height=a,n.t$1.toCartesian(V,t,r)}function X(t,e,a){return n.t.subtract(t,e,a),n.t.normalize(a,a),a}function J(t,e,a,r){return r=X(t,e,r),r=n.t.cross(r,a,r),r=n.t.normalize(r,r),r=n.t.cross(a,r,r)}R.pack=function(t,e,o){a.o.typeOf.object("value",t),a.o.defined("array",e);var s=r.u(o,0),l=t._positions,c=l.length;e[s++]=c;for(var u=0;u<c;++u){var p=l[u];n.t.pack(p,e,s),s+=3}return e[s++]=t.granularity,e[s++]=t.loop?1:0,e[s++]=t.arcType,i.t.pack(t._ellipsoid,e,s),s+=i.t.packedLength,e[s++]=t._projectionIndex,e[s++]=t._scene3DOnly?1:0,e},R.unpack=function(t,e,o){a.o.defined("array",t);for(var s=r.u(e,0),l=t[s++],c=new Array(l),u=0;u<l;u++)c[u]=n.t.unpack(t,s),s+=3;var p=t[s++],d=1===t[s++],h=t[s++],g=i.t.unpack(t,s);s+=i.t.packedLength;var f=t[s++],w=1===t[s++];if(!r.e(o)){var m=new R({positions:c,granularity:p,loop:d,arcType:h,ellipsoid:g});return m._projectionIndex=f,m._scene3DOnly=w,m}return o._positions=c,o.granularity=p,o.loop=d,o.arcType=h,o._ellipsoid=g,o._projectionIndex=f,o._scene3DOnly=w,o};var Q=new n.t,K=new n.t,tt=new n.t,et=new n.t;function nt(t,e,a,r,i){var o=X(a,e,et),s=J(t,e,o,Q),l=J(r,e,o,K);if(f.e.equalsEpsilon(n.t.dot(s,l),-1,f.e.EPSILON5))return i=n.t.cross(o,s,i),i=n.t.normalize(i,i);i=n.t.add(l,s,i),i=n.t.normalize(i,i);var c=n.t.cross(o,i,tt);return n.t.dot(l,c)<0&&(i=n.t.negate(i,i)),i}var at=m.o.fromPointNormal(n.t.ZERO,n.t.UNIT_Y),rt=new n.t,it=new n.t,ot=new n.t,st=new n.t,lt=new n.t,ct=new n.t,ut=new n.t$1,pt=new n.t$1,dt=new n.t$1;R.createGeometry=function(t){var e,a,i=!t._scene3DOnly,o=t.loop,c=t._ellipsoid,u=t.granularity,d=t.arcType,h=new D[t._projectionIndex](c),w=1e3,m=t._positions,v=m.length;2===v&&(o=!1);var y,E,T,_,I,O,k,P=new p.P(void 0,void 0,c),S=[m[0]];for(a=0;a<v-1;a++)y=m[a],E=m[a+1],I=g.g.lineSegmentPlane(y,E,at,ct),r.e(I)&&!n.t.equalsEpsilon(I,y,f.e.EPSILON7)&&!n.t.equalsEpsilon(I,E,f.e.EPSILON7)&&(t.arcType===s.L.GEODESIC?S.push(n.t.clone(I)):t.arcType===s.L.RHUMB&&(k=c.cartesianToCartographic(I,ut).longitude,T=c.cartesianToCartographic(y,ut),_=c.cartesianToCartographic(E,pt),P.setEndPoints(T,_),O=P.findIntersectionWithLongitude(k,dt),I=c.cartographicToCartesian(O,ct),r.e(I)&&!n.t.equalsEpsilon(I,y,f.e.EPSILON7)&&!n.t.equalsEpsilon(I,E,f.e.EPSILON7)&&S.push(n.t.clone(I)))),S.push(E);o&&(y=m[v-1],E=m[0],I=g.g.lineSegmentPlane(y,E,at,ct),r.e(I)&&!n.t.equalsEpsilon(I,y,f.e.EPSILON7)&&!n.t.equalsEpsilon(I,E,f.e.EPSILON7)&&(t.arcType===s.L.GEODESIC?S.push(n.t.clone(I)):t.arcType===s.L.RHUMB&&(k=c.cartesianToCartographic(I,ut).longitude,T=c.cartesianToCartographic(y,ut),_=c.cartesianToCartographic(E,pt),P.setEndPoints(T,_),O=P.findIntersectionWithLongitude(k,dt),I=c.cartographicToCartesian(O,ct),r.e(I)&&!n.t.equalsEpsilon(I,y,f.e.EPSILON7)&&!n.t.equalsEpsilon(I,E,f.e.EPSILON7)&&S.push(n.t.clone(I)))));var L=S.length,b=new Array(L);for(a=0;a<L;a++){var x=n.t$1.fromCartesian(S[a],c);x.height=0,b[a]=x}if(!((L=(b=l.D(b,n.t$1.equalsEpsilon)).length)<2)){var A=[],C=[],N=[],H=[],M=rt,z=it,R=ot,$=st,j=lt,F=b[0],B=b[1];for(M=Z(c,b[L-1],0,M),$=Z(c,B,0,$),z=Z(c,F,0,z),R=Z(c,F,w,R),j=o?nt(M,z,R,$,j):G(F,B,w,c,j),n.t.pack(j,C,0),n.t.pack(z,N,0),n.t.pack(R,H,0),A.push(F.latitude),A.push(F.longitude),Y(F,B,0,w,u,d,c,C,N,H,A),a=1;a<L-1;++a){M=n.t.clone(z,M),z=n.t.clone($,z);var q=b[a];Z(c,q,w,R),Z(c,b[a+1],0,$),nt(M,z,R,$,j),e=C.length,n.t.pack(j,C,e),n.t.pack(z,N,e),n.t.pack(R,H,e),A.push(q.latitude),A.push(q.longitude),Y(b[a],b[a+1],0,w,u,d,c,C,N,H,A)}var U=b[L-1],W=b[L-2];if(z=Z(c,U,0,z),R=Z(c,U,w,R),o){var V=b[0];j=nt(M=Z(c,W,0,M),z,R,$=Z(c,V,0,$),j)}else j=G(W,U,w,c,j);if(e=C.length,n.t.pack(j,C,e),n.t.pack(z,N,e),n.t.pack(R,H,e),A.push(U.latitude),A.push(U.longitude),o){for(Y(U,F,0,w,u,d,c,C,N,H,A),e=C.length,a=0;a<3;++a)C[e+a]=C[a],N[e+a]=N[a],H[e+a]=H[a];A.push(F.latitude),A.push(F.longitude)}return ie(o,h,N,H,C,A,i)}};var ht=new n.t,gt=new w.p,ft=new h.n;function wt(t,e,a,r){var i=X(a,e,ht),o=n.t.dot(i,t);if(o>M||o<z){var s=X(r,a,et),l=o<z?f.e.PI_OVER_TWO:-f.e.PI_OVER_TWO,c=h.n.fromAxisAngle(s,l,ft),u=w.p.fromQuaternion(c,gt);return w.p.multiplyByVector(u,t,t),!0}return!1}var mt=new n.t$1,vt=new n.t,yt=new n.t;function Et(t,e,a,r,i){var o=n.t$1.toCartesian(e,t._ellipsoid,vt),s=n.t.add(o,a,yt),l=!1,c=t._ellipsoid,u=c.cartesianToCartographic(s,mt);Math.abs(e.longitude-u.longitude)>f.e.PI_OVER_TWO&&(l=!0,s=n.t.subtract(o,a,yt),u=c.cartesianToCartographic(s,mt)),u.height=0;var p=t.project(u,i);return(i=n.t.subtract(p,r,i)).z=0,i=n.t.normalize(i,i),l&&n.t.negate(i,i),i}var Tt=new n.t,_t=new n.t;function It(t,e,a,r,i,o){var s=n.t.subtract(e,t,Tt);n.t.normalize(s,s);var l=a-0,c=n.t.multiplyByScalar(s,l,_t);n.t.add(t,c,i);var u=r-1e3;c=n.t.multiplyByScalar(s,u,_t),n.t.add(e,c,o)}var Ot=new n.t;function kt(t,e){var a=m.o.getPointDistance(at,t),r=m.o.getPointDistance(at,e),i=Ot;f.e.equalsEpsilon(a,0,f.e.EPSILON2)?(i=X(e,t,i),n.t.multiplyByScalar(i,f.e.EPSILON2,i),n.t.add(t,i,t)):f.e.equalsEpsilon(r,0,f.e.EPSILON2)&&(i=X(t,e,i),n.t.multiplyByScalar(i,f.e.EPSILON2,i),n.t.add(e,i,e))}function Pt(t,e){var n=Math.abs(t.longitude),a=Math.abs(e.longitude);if(f.e.equalsEpsilon(n,f.e.PI,f.e.EPSILON11)){var r=f.e.sign(e.longitude);return t.longitude=r*(n-f.e.EPSILON11),1}if(f.e.equalsEpsilon(a,f.e.PI,f.e.EPSILON11)){var i=f.e.sign(t.longitude);return e.longitude=i*(a-f.e.EPSILON11),2}return 0}var St=new n.t$1,Lt=new n.t$1,bt=new n.t,xt=new n.t,At=new n.t,Ct=new n.t,Nt=new n.t,Dt=new n.t,Ht=[St,Lt],Mt=new i.h,zt=new n.t,Rt=new n.t,$t=new n.t,jt=new n.t,Ft=new n.t,Gt=new n.t,Bt=new n.t,qt=new n.t,Ut=new n.t,Wt=new n.t,Yt=new n.t,Vt=new n.t,Zt=new n.t,Xt=new n.t,Jt=new d.i,Qt=new d.i,Kt=new n.t,te=new n.t,ee=new n.t,ne=[new t.i,new t.i],ae=[0,2,1,0,3,2,0,7,3,0,4,7,0,5,4,0,1,5,5,7,4,5,6,7,5,2,6,5,1,2,3,6,2,3,7,6],re=ae.length;function ie(e,a,r,o,s,l,u){var p,g,w,m,v,y,E=a._ellipsoid,T=r.length/3-1,_=8*T,I=4*_,O=36*T,k=_>65535?new Uint32Array(O):new Uint16Array(O),P=new Float64Array(3*_),S=new Float32Array(I),L=new Float32Array(I),b=new Float32Array(I),x=new Float32Array(I),A=new Float32Array(I);u&&(w=new Float32Array(I),m=new Float32Array(I),v=new Float32Array(I),y=new Float32Array(2*_));var N=l.length/2,D=0,H=St;H.height=0;var z=Lt;z.height=0;var R=bt,$=xt;if(u)for(g=0,p=1;p<N;p++)H.latitude=l[g],H.longitude=l[g+1],z.latitude=l[g+2],z.longitude=l[g+3],R=a.project(H,R),$=a.project(z,$),D+=n.t.distance(R,$),g+=2;var j=o.length/3;$=n.t.unpack(o,0,$);var F,G=0;for(g=3,p=1;p<j;p++)R=n.t.clone($,R),$=n.t.unpack(o,g,$),G+=n.t.distance(R,$),g+=3;g=3;var B=0,q=0,U=0,W=0,Y=!1,V=n.t.unpack(r,0,Ct),Z=n.t.unpack(o,0,xt),J=n.t.unpack(s,0,Dt);e&&(wt(J,n.t.unpack(r,r.length-6,At),V,Z)&&(J=n.t.negate(J,J)));var Q=0,K=0,tt=0;for(p=0;p<T;p++){var et,nt,at,rt,it=n.t.clone(V,At),ot=n.t.clone(Z,bt),st=n.t.clone(J,Nt);if(Y&&(st=n.t.negate(st,st)),V=n.t.unpack(r,g,Ct),Z=n.t.unpack(o,g,xt),Y=wt(J=n.t.unpack(s,g,Dt),it,V,Z),H.latitude=l[B],H.longitude=l[B+1],z.latitude=l[B+2],z.longitude=l[B+3],u){var lt=Pt(H,z);et=a.project(H,Ft);var ct=X(nt=a.project(z,Gt),et,Kt);ct.y=Math.abs(ct.y),at=Bt,rt=qt,0===lt||n.t.dot(ct,n.t.UNIT_Y)>M?(at=Et(a,H,st,et,Bt),rt=Et(a,z,J,nt,qt)):1===lt?(rt=Et(a,z,J,nt,qt),at.x=0,at.y=f.e.sign(H.longitude-Math.abs(z.longitude)),at.z=0):(at=Et(a,H,st,et,Bt),rt.x=0,rt.y=f.e.sign(H.longitude-z.longitude),rt.z=0)}var ut=n.t.distance(ot,Z),pt=d.i.fromCartesian(it,Jt),dt=n.t.subtract(V,it,Ut),ht=n.t.normalize(dt,Vt),gt=n.t.subtract(ot,it,Wt);gt=n.t.normalize(gt,gt);var ft=n.t.cross(ht,gt,Vt);ft=n.t.normalize(ft,ft);var mt=n.t.cross(gt,st,Zt);mt=n.t.normalize(mt,mt);var vt=n.t.subtract(Z,V,Yt);vt=n.t.normalize(vt,vt);var yt=n.t.cross(J,vt,Xt);yt=n.t.normalize(yt,yt);var Tt,_t,Ot,ie=ut/G,se=Q/G,le=0,ce=0,ue=0;if(u){le=n.t.distance(et,nt),Tt=d.i.fromCartesian(et,Qt),_t=n.t.subtract(nt,et,Kt);var pe=(Ot=n.t.normalize(_t,te)).x;Ot.x=Ot.y,Ot.y=-pe,ce=le/D,ue=K/D}for(F=0;F<8;F++){var de=W+4*F,he=q+2*F,ge=de+3,fe=F<4?1:-1,we=2===F||3===F||6===F||7===F?1:-1;n.t.pack(pt.high,S,de),S[ge]=dt.x,n.t.pack(pt.low,L,de),L[ge]=dt.y,n.t.pack(mt,b,de),b[ge]=dt.z,n.t.pack(yt,x,de),x[ge]=ie*fe,n.t.pack(ft,A,de);var me=se*we;0===me&&we<0&&(me=Number.POSITIVE_INFINITY),A[ge]=me,u&&(w[de]=Tt.high.x,w[de+1]=Tt.high.y,w[de+2]=Tt.low.x,w[de+3]=Tt.low.y,v[de]=-at.y,v[de+1]=at.x,v[de+2]=rt.y,v[de+3]=-rt.x,m[de]=_t.x,m[de+1]=_t.y,m[de+2]=Ot.x,m[de+3]=Ot.y,y[he]=ce*fe,0===(me=ue*we)&&we<0&&(me=Number.POSITIVE_INFINITY),y[he+1]=me)}var ve=$t,ye=jt,Ee=zt,Te=Rt,_e=i.h.fromCartographicArray(Ht,Mt),Ie=C.getMinimumMaximumHeights(_e,E),Oe=Ie.minimumTerrainHeight,ke=Ie.maximumTerrainHeight;tt+=Oe,tt+=ke,It(it,ot,Oe,ke,ve,Ee),It(V,Z,Oe,ke,ye,Te);var Pe=n.t.multiplyByScalar(ft,f.e.EPSILON5,ee);n.t.add(ve,Pe,ve),n.t.add(ye,Pe,ye),n.t.add(Ee,Pe,Ee),n.t.add(Te,Pe,Te),kt(ve,ye),kt(Ee,Te),n.t.pack(ve,P,U),n.t.pack(ye,P,U+3),n.t.pack(Te,P,U+6),n.t.pack(Ee,P,U+9),Pe=n.t.multiplyByScalar(ft,-2*f.e.EPSILON5,ee),n.t.add(ve,Pe,ve),n.t.add(ye,Pe,ye),n.t.add(Ee,Pe,Ee),n.t.add(Te,Pe,Te),kt(ve,ye),kt(Ee,Te),n.t.pack(ve,P,U+12),n.t.pack(ye,P,U+15),n.t.pack(Te,P,U+18),n.t.pack(Ee,P,U+21),B+=2,g+=3,q+=16,U+=24,W+=32,Q+=ut,K+=le}g=0;var Se=0;for(p=0;p<T;p++){for(F=0;F<re;F++)k[g+F]=ae[F]+Se;Se+=8,g+=re}var Le=ne;t.i.fromVertices(r,n.t.ZERO,3,Le[0]),t.i.fromVertices(o,n.t.ZERO,3,Le[1]);var be=t.i.fromBoundingSpheres(Le);be.radius+=tt/(2*T);var xe={position:new h.o({componentDatatype:c.ComponentDatatype.DOUBLE,componentsPerAttribute:3,normalize:!1,values:P}),startHiAndForwardOffsetX:oe(S),startLoAndForwardOffsetY:oe(L),startNormalAndForwardOffsetZ:oe(b),endNormalAndTextureCoordinateNormalizationX:oe(x),rightNormalAndTextureCoordinateNormalizationY:oe(A)};return u&&(xe.startHiLo2D=oe(w),xe.offsetAndRight2D=oe(m),xe.startEndNormals2D=oe(v),xe.texcoordNormalization2D=new h.o({componentDatatype:c.ComponentDatatype.FLOAT,componentsPerAttribute:2,normalize:!1,values:y})),new h.I({attributes:xe,indices:k,boundingSphere:be})}function oe(t){return new h.o({componentDatatype:c.ComponentDatatype.FLOAT,componentsPerAttribute:4,normalize:!1,values:t})}return R._projectNormal=Et,function(t,e){return C.initialize().then((function(){return r.e(e)&&(t=R.unpack(t,e)),R.createGeometry(t)}))}}));
