define(["./arrayFill-deb10550","./arrayRemoveDuplicates-74caa2f4","./buildModuleUrl-d920237a","./Cartographic-1d953166","./Check-2514d21d","./ComponentDatatype-07894a2b","./PolylineVolumeGeometryLibrary-33dc94e9","./CorridorGeometryLibrary-66b90766","./when-d186add7","./Rectangle-f841217d","./GeometryAttribute-95780fd1","./GeometryAttributes-9c67dd14","./GeometryOffsetAttribute-da5a1d35","./IndexDatatype-61ffec74","./Math-7f5f2992","./PolygonPipeline-6809c3ce","./FeatureDetection-4281d393","./VertexFormat-769ac289","./Event-50568704","./RuntimeError-4a74cd1a","./WebGLConstants-8d1e45f7","./Cartesian2-2b41fabe","./Cartesian4-3408960c","./EllipsoidTangentPlane-e12285fe","./IntersectionTests-300d4352","./Plane-d9914d3c","./PolylinePipeline-cea0bf86","./EllipsoidGeodesic-fc4b25bd","./EllipsoidRhumbLine-394d2834"],(function(t,e,r,a,o,n,i,s,d,l,u,c,f,m,h,p,g,b,v,y,A,_,w,T,E,N,D,P,I){"use strict";var x=new a.t,F=new a.t,O=new a.t,M=new a.t,S=new a.t,L=new a.t,C=new a.t,V=new a.t;function G(t,e){for(var r=0;r<t.length;r++)t[r]=e.scaleToGeodeticSurface(t[r],t[r]);return t}function k(t,e,r,o,n,i){var d=t.normals,l=t.tangents,u=t.bitangents,c=a.t.normalize(a.t.cross(r,e,C),C);i.normal&&s.b.addAttribute(d,e,o,n),i.tangent&&s.b.addAttribute(l,c,o,n),i.bitangent&&s.b.addAttribute(u,r,o,n)}function R(t,e,r){var o,i,l,f=t.positions,p=t.corners,g=t.endPositions,b=t.lefts,v=t.normals,y=new c.a,A=0,_=0,w=0;for(i=0;i<f.length;i+=2)A+=l=f[i].length-3,w+=2*l,_+=f[i+1].length-3;for(A+=3,_+=3,i=0;i<p.length;i++){o=p[i];var T=p[i].leftPositions;d.e(T)?(A+=l=T.length,w+=l):(_+=l=p[i].rightPositions.length,w+=l)}var E,N=d.e(g);N&&(A+=E=g[0].length-3,_+=E,w+=6*(E/=3));var D,P,I,S,G,R,z=A+_,H=new Float64Array(z),U={normals:e.normal?new Float32Array(z):void 0,tangents:e.tangent?new Float32Array(z):void 0,bitangents:e.bitangent?new Float32Array(z):void 0},Y=0,B=z-1,W=x,q=F,$=E/2,J=m.IndexDatatype.createTypedArray(z/3,w),j=0;if(N){R=O,G=M;var K=g[0];for(W=a.t.fromArray(v,0,W),q=a.t.fromArray(b,0,q),i=0;i<$;i++)R=a.t.fromArray(K,3*($-1-i),R),G=a.t.fromArray(K,3*($+i),G),s.b.addAttribute(H,G,Y),s.b.addAttribute(H,R,void 0,B),k(U,W,q,Y,B,e),S=(P=Y/3)+1,I=(D=(B-2)/3)-1,J[j++]=D,J[j++]=P,J[j++]=I,J[j++]=I,J[j++]=P,J[j++]=S,Y+=3,B-=3}var Q,X,Z=0,tt=0,et=f[Z++],rt=f[Z++];for(H.set(et,Y),H.set(rt,B-rt.length+1),q=a.t.fromArray(b,tt,q),l=rt.length-3,i=0;i<l;i+=3)Q=r.geodeticSurfaceNormal(a.t.fromArray(et,i,C),C),X=r.geodeticSurfaceNormal(a.t.fromArray(rt,l-i,V),V),k(U,W=a.t.normalize(a.t.add(Q,X,W),W),q,Y,B,e),S=(P=Y/3)+1,I=(D=(B-2)/3)-1,J[j++]=D,J[j++]=P,J[j++]=I,J[j++]=I,J[j++]=P,J[j++]=S,Y+=3,B-=3;for(Q=r.geodeticSurfaceNormal(a.t.fromArray(et,l,C),C),X=r.geodeticSurfaceNormal(a.t.fromArray(rt,l,V),V),W=a.t.normalize(a.t.add(Q,X,W),W),tt+=3,i=0;i<p.length;i++){var at,ot,nt,it=(o=p[i]).leftPositions,st=o.rightPositions,dt=L,lt=O,ut=M;if(W=a.t.fromArray(v,tt,W),d.e(it)){for(k(U,W,q,void 0,B,e),B-=3,ot=S,nt=I,at=0;at<it.length/3;at++)dt=a.t.fromArray(it,3*at,dt),J[j++]=ot,J[j++]=nt-at-1,J[j++]=nt-at,s.b.addAttribute(H,dt,void 0,B),lt=a.t.fromArray(H,3*(nt-at-1),lt),ut=a.t.fromArray(H,3*ot,ut),k(U,W,q=a.t.normalize(a.t.subtract(lt,ut,q),q),void 0,B,e),B-=3;dt=a.t.fromArray(H,3*ot,dt),lt=a.t.subtract(a.t.fromArray(H,3*nt,lt),dt,lt),ut=a.t.subtract(a.t.fromArray(H,3*(nt-at),ut),dt,ut),k(U,W,q=a.t.normalize(a.t.add(lt,ut,q),q),Y,void 0,e),Y+=3}else{for(k(U,W,q,Y,void 0,e),Y+=3,ot=I,nt=S,at=0;at<st.length/3;at++)dt=a.t.fromArray(st,3*at,dt),J[j++]=ot,J[j++]=nt+at,J[j++]=nt+at+1,s.b.addAttribute(H,dt,Y),lt=a.t.fromArray(H,3*ot,lt),ut=a.t.fromArray(H,3*(nt+at),ut),k(U,W,q=a.t.normalize(a.t.subtract(lt,ut,q),q),Y,void 0,e),Y+=3;dt=a.t.fromArray(H,3*ot,dt),lt=a.t.subtract(a.t.fromArray(H,3*(nt+at),lt),dt,lt),ut=a.t.subtract(a.t.fromArray(H,3*nt,ut),dt,ut),k(U,W,q=a.t.normalize(a.t.negate(a.t.add(ut,lt,q),q),q),void 0,B,e),B-=3}for(et=f[Z++],rt=f[Z++],et.splice(0,3),rt.splice(rt.length-3,3),H.set(et,Y),H.set(rt,B-rt.length+1),l=rt.length-3,tt+=3,q=a.t.fromArray(b,tt,q),at=0;at<rt.length;at+=3)Q=r.geodeticSurfaceNormal(a.t.fromArray(et,at,C),C),X=r.geodeticSurfaceNormal(a.t.fromArray(rt,l-at,V),V),k(U,W=a.t.normalize(a.t.add(Q,X,W),W),q,Y,B,e),P=(S=Y/3)-1,D=(I=(B-2)/3)+1,J[j++]=D,J[j++]=P,J[j++]=I,J[j++]=I,J[j++]=P,J[j++]=S,Y+=3,B-=3;Y-=3,B+=3}if(k(U,W=a.t.fromArray(v,v.length-3,W),q,Y,B,e),N){Y+=3,B-=3,R=O,G=M;var ct=g[1];for(i=0;i<$;i++)R=a.t.fromArray(ct,3*(E-i-1),R),G=a.t.fromArray(ct,3*i,G),s.b.addAttribute(H,R,void 0,B),s.b.addAttribute(H,G,Y),k(U,W,q,Y,B,e),P=(S=Y/3)-1,D=(I=(B-2)/3)+1,J[j++]=D,J[j++]=P,J[j++]=I,J[j++]=I,J[j++]=P,J[j++]=S,Y+=3,B-=3}if(y.position=new u.o({componentDatatype:n.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:H}),e.st){var ft,mt,ht=new Float32Array(z/3*2),pt=0;if(N){A/=3,_/=3;var gt=Math.PI/(E+1);mt=1/(A-E+1),ft=1/(_-E+1);var bt,vt=E/2;for(i=vt+1;i<E+1;i++)bt=h.e.PI_OVER_TWO+gt*i,ht[pt++]=ft*(1+Math.cos(bt)),ht[pt++]=.5*(1+Math.sin(bt));for(i=1;i<_-E+1;i++)ht[pt++]=i*ft,ht[pt++]=0;for(i=E;i>vt;i--)bt=h.e.PI_OVER_TWO-i*gt,ht[pt++]=1-ft*(1+Math.cos(bt)),ht[pt++]=.5*(1+Math.sin(bt));for(i=vt;i>0;i--)bt=h.e.PI_OVER_TWO-gt*i,ht[pt++]=1-mt*(1+Math.cos(bt)),ht[pt++]=.5*(1+Math.sin(bt));for(i=A-E;i>0;i--)ht[pt++]=i*mt,ht[pt++]=1;for(i=1;i<vt+1;i++)bt=h.e.PI_OVER_TWO+gt*i,ht[pt++]=mt*(1+Math.cos(bt)),ht[pt++]=.5*(1+Math.sin(bt))}else{for(mt=1/((A/=3)-1),ft=1/((_/=3)-1),i=0;i<_;i++)ht[pt++]=i*ft,ht[pt++]=0;for(i=A;i>0;i--)ht[pt++]=(i-1)*mt,ht[pt++]=1}y.st=new u.o({componentDatatype:n.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:ht})}return e.normal&&(y.normal=new u.o({componentDatatype:n.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:U.normals})),e.tangent&&(y.tangent=new u.o({componentDatatype:n.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:U.tangents})),e.bitangent&&(y.bitangent=new u.o({componentDatatype:n.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:U.bitangents})),{attributes:y,indices:J}}function z(t,e,r){r[e++]=t[0],r[e++]=t[1],r[e++]=t[2];for(var a=3;a<t.length;a+=3){var o=t[a],n=t[a+1],i=t[a+2];r[e++]=o,r[e++]=n,r[e++]=i,r[e++]=o,r[e++]=n,r[e++]=i}return r[e++]=t[0],r[e++]=t[1],r[e++]=t[2],r}function H(e,r){var o=new b.n({position:r.position,normal:r.normal||r.bitangent||e.shadowVolume,tangent:r.tangent,bitangent:r.normal||r.bitangent,st:r.st}),i=e.ellipsoid,l=R(s.b.computePositions(e),o,i),c=e.height,h=e.extrudedHeight,g=l.attributes,v=l.indices,y=g.position.values,A=y.length,_=new Float64Array(6*A),w=new Float64Array(A);w.set(y);var T=new Float64Array(4*A);T=z(y=p.A.scaleToGeodeticHeight(y,c,i),0,T),T=z(w=p.A.scaleToGeodeticHeight(w,h,i),2*A,T),_.set(y),_.set(w,A),_.set(T,2*A),g.position.values=_,g=function(t,e){if(!(e.normal||e.tangent||e.bitangent||e.st))return t;var r,o,n=t.position.values;(e.normal||e.bitangent)&&(r=t.normal.values,o=t.bitangent.values);var i,d=t.position.values.length/18,l=3*d,u=2*d,c=2*l;if(e.normal||e.bitangent||e.tangent){var f=e.normal?new Float32Array(6*l):void 0,m=e.tangent?new Float32Array(6*l):void 0,h=e.bitangent?new Float32Array(6*l):void 0,p=x,g=F,b=O,v=M,y=S,A=L,_=c;for(i=0;i<l;i+=3){var w=_+c;p=a.t.fromArray(n,i,p),g=a.t.fromArray(n,i+l,g),b=a.t.fromArray(n,(i+3)%l,b),g=a.t.subtract(g,p,g),b=a.t.subtract(b,p,b),v=a.t.normalize(a.t.cross(g,b,v),v),e.normal&&(s.b.addAttribute(f,v,w),s.b.addAttribute(f,v,w+3),s.b.addAttribute(f,v,_),s.b.addAttribute(f,v,_+3)),(e.tangent||e.bitangent)&&(A=a.t.fromArray(r,i,A),e.bitangent&&(s.b.addAttribute(h,A,w),s.b.addAttribute(h,A,w+3),s.b.addAttribute(h,A,_),s.b.addAttribute(h,A,_+3)),e.tangent&&(y=a.t.normalize(a.t.cross(A,v,y),y),s.b.addAttribute(m,y,w),s.b.addAttribute(m,y,w+3),s.b.addAttribute(m,y,_),s.b.addAttribute(m,y,_+3))),_+=6}if(e.normal){for(f.set(r),i=0;i<l;i+=3)f[i+l]=-r[i],f[i+l+1]=-r[i+1],f[i+l+2]=-r[i+2];t.normal.values=f}else t.normal=void 0;if(e.bitangent?(h.set(o),h.set(o,l),t.bitangent.values=h):t.bitangent=void 0,e.tangent){var T=t.tangent.values;m.set(T),m.set(T,l),t.tangent.values=m}}if(e.st){var E=t.st.values,N=new Float32Array(6*u);N.set(E),N.set(E,u);for(var D=2*u,P=0;P<2;P++){for(N[D++]=E[0],N[D++]=E[1],i=2;i<u;i+=2){var I=E[i],C=E[i+1];N[D++]=I,N[D++]=C,N[D++]=I,N[D++]=C}N[D++]=E[0],N[D++]=E[1]}t.st.values=N}return t}(g,r);var E,N=A/3;if(e.shadowVolume){var D=g.normal.values;A=D.length;var P=new Float32Array(6*A);for(E=0;E<A;E++)D[E]=-D[E];P.set(D,A),P=z(D,4*A,P),g.extrudeDirection=new u.o({componentDatatype:n.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:P}),r.normal||(g.normal=void 0)}if(d.e(e.offsetAttribute)){var I=new Uint8Array(6*N);if(e.offsetAttribute===f.z.TOP)I=t.d(I,1,0,N),I=t.d(I,1,2*N,4*N);else{var C=e.offsetAttribute===f.z.NONE?0:1;I=t.d(I,C)}g.applyOffset=new u.o({componentDatatype:n.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:I})}var V=v.length,G=N+N,k=m.IndexDatatype.createTypedArray(_.length/3,2*V+3*G);k.set(v);var H,U,Y,B,W=V;for(E=0;E<V;E+=3){var q=v[E],$=v[E+1],J=v[E+2];k[W++]=J+N,k[W++]=$+N,k[W++]=q+N}for(E=0;E<G;E+=2)Y=(H=E+G)+1,B=(U=H+G)+1,k[W++]=H,k[W++]=U,k[W++]=Y,k[W++]=Y,k[W++]=U,k[W++]=B;return{attributes:g,indices:k}}var U=new a.t,Y=new a.t,B=new a.t$1;function W(t,e,r,o,n,i){var s=a.t.subtract(e,t,U);a.t.normalize(s,s);var d=r.geodeticSurfaceNormal(t,Y),l=a.t.cross(s,d,U);a.t.multiplyByScalar(l,o,l);var u=n.latitude,c=n.longitude,f=i.latitude,m=i.longitude;a.t.add(t,l,Y),r.cartesianToCartographic(Y,B);var h=B.latitude,p=B.longitude;u=Math.min(u,h),c=Math.min(c,p),f=Math.max(f,h),m=Math.max(m,p),a.t.subtract(t,l,Y),r.cartesianToCartographic(Y,B),h=B.latitude,p=B.longitude,u=Math.min(u,h),c=Math.min(c,p),f=Math.max(f,h),m=Math.max(m,p),n.latitude=u,n.longitude=c,i.latitude=f,i.longitude=m}var q=new a.t,$=new a.t,J=new a.t$1,j=new a.t$1;function K(t,r,o,n,s){t=G(t,r);var u=e.D(t,a.t.equalsEpsilon),c=u.length;if(c<2||o<=0)return new l.h;var f,m,h=.5*o;if(J.latitude=Number.POSITIVE_INFINITY,J.longitude=Number.POSITIVE_INFINITY,j.latitude=Number.NEGATIVE_INFINITY,j.longitude=Number.NEGATIVE_INFINITY,n===i.S.ROUNDED){var p=u[0];a.t.subtract(p,u[1],q),a.t.normalize(q,q),a.t.multiplyByScalar(q,h,q),a.t.add(p,q,$),r.cartesianToCartographic($,B),f=B.latitude,m=B.longitude,J.latitude=Math.min(J.latitude,f),J.longitude=Math.min(J.longitude,m),j.latitude=Math.max(j.latitude,f),j.longitude=Math.max(j.longitude,m)}for(var g=0;g<c-1;++g)W(u[g],u[g+1],r,h,J,j);var b=u[c-1];a.t.subtract(b,u[c-2],q),a.t.normalize(q,q),a.t.multiplyByScalar(q,h,q),a.t.add(b,q,$),W(b,$,r,h,J,j),n===i.S.ROUNDED&&(r.cartesianToCartographic($,B),f=B.latitude,m=B.longitude,J.latitude=Math.min(J.latitude,f),J.longitude=Math.min(J.longitude,m),j.latitude=Math.max(j.latitude,f),j.longitude=Math.max(j.longitude,m));var v=d.e(s)?s:new l.h;return v.north=j.latitude,v.south=J.latitude,v.east=j.longitude,v.west=J.longitude,v}function Q(t){var e=(t=d.u(t,d.u.EMPTY_OBJECT)).positions,r=t.width;o.o.defined("options.positions",e),o.o.defined("options.width",r);var n=d.u(t.height,0),s=d.u(t.extrudedHeight,n);this._positions=e,this._ellipsoid=l.t.clone(d.u(t.ellipsoid,l.t.WGS84)),this._vertexFormat=b.n.clone(d.u(t.vertexFormat,b.n.DEFAULT)),this._width=r,this._height=Math.max(n,s),this._extrudedHeight=Math.min(n,s),this._cornerType=d.u(t.cornerType,i.S.ROUNDED),this._granularity=d.u(t.granularity,h.e.RADIANS_PER_DEGREE),this._shadowVolume=d.u(t.shadowVolume,!1),this._workerName="createCorridorGeometry",this._offsetAttribute=t.offsetAttribute,this._rectangle=void 0,this.packedLength=1+e.length*a.t.packedLength+l.t.packedLength+b.n.packedLength+7}Q.pack=function(t,e,r){o.o.defined("value",t),o.o.defined("array",e),r=d.u(r,0);var n=t._positions,i=n.length;e[r++]=i;for(var s=0;s<i;++s,r+=a.t.packedLength)a.t.pack(n[s],e,r);return l.t.pack(t._ellipsoid,e,r),r+=l.t.packedLength,b.n.pack(t._vertexFormat,e,r),r+=b.n.packedLength,e[r++]=t._width,e[r++]=t._height,e[r++]=t._extrudedHeight,e[r++]=t._cornerType,e[r++]=t._granularity,e[r++]=t._shadowVolume?1:0,e[r]=d.u(t._offsetAttribute,-1),e};var X=l.t.clone(l.t.UNIT_SPHERE),Z=new b.n,tt={positions:void 0,ellipsoid:X,vertexFormat:Z,width:void 0,height:void 0,extrudedHeight:void 0,cornerType:void 0,granularity:void 0,shadowVolume:void 0,offsetAttribute:void 0};return Q.unpack=function(t,e,r){o.o.defined("array",t),e=d.u(e,0);for(var n=t[e++],i=new Array(n),s=0;s<n;++s,e+=a.t.packedLength)i[s]=a.t.unpack(t,e);var u=l.t.unpack(t,e,X);e+=l.t.packedLength;var c=b.n.unpack(t,e,Z);e+=b.n.packedLength;var f=t[e++],m=t[e++],h=t[e++],p=t[e++],g=t[e++],v=1===t[e++],y=t[e];return d.e(r)?(r._positions=i,r._ellipsoid=l.t.clone(u,r._ellipsoid),r._vertexFormat=b.n.clone(c,r._vertexFormat),r._width=f,r._height=m,r._extrudedHeight=h,r._cornerType=p,r._granularity=g,r._shadowVolume=v,r._offsetAttribute=-1===y?void 0:y,r):(tt.positions=i,tt.width=f,tt.height=m,tt.extrudedHeight=h,tt.cornerType=p,tt.granularity=g,tt.shadowVolume=v,tt.offsetAttribute=-1===y?void 0:y,new Q(tt))},Q.computeRectangle=function(t,e){var r=(t=d.u(t,d.u.EMPTY_OBJECT)).positions,a=t.width;return o.o.defined("options.positions",r),o.o.defined("options.width",a),K(r,d.u(t.ellipsoid,l.t.WGS84),a,d.u(t.cornerType,i.S.ROUNDED),e)},Q.createGeometry=function(o){var i=o._positions,l=o._width,c=o._ellipsoid;i=G(i,c);var m=e.D(i,a.t.equalsEpsilon);if(!(m.length<2||l<=0)){var b,v=o._height,y=o._extrudedHeight,A=!h.e.equalsEpsilon(v,y,0,h.e.EPSILON2),_=o._vertexFormat,w={ellipsoid:c,positions:m,width:l,cornerType:o._cornerType,granularity:o._granularity,saveAttributes:!0};if(A)w.height=v,w.extrudedHeight=y,w.shadowVolume=o._shadowVolume,w.offsetAttribute=o._offsetAttribute,b=H(w,_);else if((b=R(s.b.computePositions(w),_,c)).attributes.position.values=p.A.scaleToGeodeticHeight(b.attributes.position.values,v,c),d.e(o._offsetAttribute)){var T=o._offsetAttribute===f.z.NONE?0:1,E=b.attributes.position.values.length,N=new Uint8Array(E/3);t.d(N,T),b.attributes.applyOffset=new u.o({componentDatatype:n.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:N})}var D=b.attributes,P=r.i.fromVertices(D.position.values,void 0,3);return _.position||(b.attributes.position.values=void 0),new u.I({attributes:D,indices:b.indices,primitiveType:g._0x12cc5d.TRIANGLES,boundingSphere:P,offsetAttribute:o._offsetAttribute})}},Q.createShadowVolume=function(t,e,r){var a=t._granularity,o=t._ellipsoid,n=e(a,o),i=r(a,o);return new Q({positions:t._positions,width:t._width,cornerType:t._cornerType,ellipsoid:o,granularity:a,extrudedHeight:n,height:i,vertexFormat:b.n.POSITION_ONLY,shadowVolume:!0})},Object.defineProperties(Q.prototype,{rectangle:{get:function(){return d.e(this._rectangle)||(this._rectangle=K(this._positions,this._ellipsoid,this._width,this._cornerType)),this._rectangle}},textureCoordinateRotationPoints:{get:function(){return[0,0,0,1,1,0]}}}),function(t,e){return d.e(e)&&(t=Q.unpack(t,e)),t._ellipsoid=l.t.clone(t._ellipsoid),Q.createGeometry(t)}}));
