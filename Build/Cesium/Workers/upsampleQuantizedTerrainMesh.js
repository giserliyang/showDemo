define(["./AttributeCompression-16430ee7","./buildModuleUrl-d920237a","./Cartesian2-2b41fabe","./Cartographic-1d953166","./when-d186add7","./Rectangle-f841217d","./TerrainEncoding-54acbe88","./IndexDatatype-61ffec74","./Check-2514d21d","./Math-7f5f2992","./OrientedBoundingBox-9c607ea0","./createTaskProcessorWorker","./FeatureDetection-4281d393","./Cartesian4-3408960c","./RuntimeError-4a74cd1a","./WebGLConstants-8d1e45f7","./Event-50568704","./ComponentDatatype-07894a2b","./EllipsoidTangentPlane-e12285fe","./IntersectionTests-300d4352","./Plane-d9914d3c","./GeometryAttribute-95780fd1","./PolygonPipeline-6809c3ce","./EllipsoidRhumbLine-394d2834","./Buffer-455831f6","./Color-2b4500b6","./BoundingRectangle-1d700ce8"],(function(e,t,i,n,r,s,h,u,o,p,d,a,f,l,g,c,m,x,w,v,y,b,B,I,A,C,H){"use strict";var T={clipTriangleAtAxisAlignedThreshold:function(e,t,i,n,s,h){if(!r.e(e))throw new o.t("threshold is required.");if(!r.e(t))throw new o.t("keepAbove is required.");if(!r.e(i))throw new o.t("u0 is required.");if(!r.e(n))throw new o.t("u1 is required.");if(!r.e(s))throw new o.t("u2 is required.");var u,p,d;r.e(h)?h.length=0:h=[],t?(u=i<e,p=n<e,d=s<e):(u=i>e,p=n>e,d=s>e);var a,f,l,g,c,m,x=u+p+d;return 1===x?u?(a=(e-i)/(n-i),f=(e-i)/(s-i),h.push(1),h.push(2),1!==f&&(h.push(-1),h.push(0),h.push(2),h.push(f)),1!==a&&(h.push(-1),h.push(0),h.push(1),h.push(a))):p?(l=(e-n)/(s-n),g=(e-n)/(i-n),h.push(2),h.push(0),1!==g&&(h.push(-1),h.push(1),h.push(0),h.push(g)),1!==l&&(h.push(-1),h.push(1),h.push(2),h.push(l))):d&&(c=(e-s)/(i-s),m=(e-s)/(n-s),h.push(0),h.push(1),1!==m&&(h.push(-1),h.push(2),h.push(1),h.push(m)),1!==c&&(h.push(-1),h.push(2),h.push(0),h.push(c))):2===x?u||i===e?p||n===e?!d&&s!==e&&(f=(e-i)/(s-i),l=(e-n)/(s-n),h.push(2),h.push(-1),h.push(0),h.push(2),h.push(f),h.push(-1),h.push(1),h.push(2),h.push(l)):(m=(e-s)/(n-s),a=(e-i)/(n-i),h.push(1),h.push(-1),h.push(2),h.push(1),h.push(m),h.push(-1),h.push(0),h.push(1),h.push(a)):(g=(e-n)/(i-n),c=(e-s)/(i-s),h.push(0),h.push(-1),h.push(1),h.push(0),h.push(g),h.push(-1),h.push(2),h.push(0),h.push(c)):3!==x&&(h.push(0),h.push(1),h.push(2)),h},computeBarycentricCoordinates:function(e,t,i,s,h,u,p,d,a){if(!r.e(e))throw new o.t("x is required.");if(!r.e(t))throw new o.t("y is required.");if(!r.e(i))throw new o.t("x1 is required.");if(!r.e(s))throw new o.t("y1 is required.");if(!r.e(h))throw new o.t("x2 is required.");if(!r.e(u))throw new o.t("y2 is required.");if(!r.e(p))throw new o.t("x3 is required.");if(!r.e(d))throw new o.t("y3 is required.");var f=i-p,l=p-h,g=u-d,c=s-d,m=1/(g*f+l*c),x=t-d,w=e-p,v=(g*w+l*x)*m,y=(-c*w+f*x)*m,b=1-v-y;return r.e(a)?(a.x=v,a.y=y,a.z=b,a):new n.t(v,y,b)},computeLineSegmentLineSegmentIntersection:function(e,t,n,s,h,u,p,d,a){o.o.typeOf.number("x00",e),o.o.typeOf.number("y00",t),o.o.typeOf.number("x01",n),o.o.typeOf.number("y01",s),o.o.typeOf.number("x10",h),o.o.typeOf.number("y10",u),o.o.typeOf.number("x11",p),o.o.typeOf.number("y11",d);var f=(d-u)*(n-e)-(p-h)*(s-t);if(0!==f){var l=((p-h)*(t-u)-(d-u)*(e-h))/f,g=((n-e)*(t-u)-(s-t)*(e-h))/f;if(l>=0&&l<=1&&g>=0&&g<=1)return r.e(a)||(a=new i.o),a.x=e+l*(n-e),a.y=t+l*(s-t),a}}},z=32767,N=16383,O=[],V=[],R=[],q=new n.t$1,E=new n.t,M=[],U=[],P=[],F=[],k=[],D=new n.t,L=new t.i,S=new d.x,X=new i.o,W=new n.t;function K(){this.vertexBuffer=void 0,this.index=void 0,this.first=void 0,this.second=void 0,this.ratio=void 0}K.prototype.clone=function(e){return r.e(e)||(e=new K),e.uBuffer=this.uBuffer,e.vBuffer=this.vBuffer,e.heightBuffer=this.heightBuffer,e.normalBuffer=this.normalBuffer,e.index=this.index,e.first=this.first,e.second=this.second,e.ratio=this.ratio,e},K.prototype.initializeIndexed=function(e,t,i,n,r){this.uBuffer=e,this.vBuffer=t,this.heightBuffer=i,this.normalBuffer=n,this.index=r,this.first=void 0,this.second=void 0,this.ratio=void 0},K.prototype.initializeFromClipResult=function(e,t,i){var n=t+1;return-1!==e[t]?i[e[t]].clone(this):(this.vertexBuffer=void 0,this.index=void 0,this.first=i[e[n]],++n,this.second=i[e[n]],++n,this.ratio=e[n],++n),n},K.prototype.getKey=function(){return this.isIndexed()?this.index:JSON.stringify({first:this.first.getKey(),second:this.second.getKey(),ratio:this.ratio})},K.prototype.isIndexed=function(){return r.e(this.index)},K.prototype.getH=function(e,t){if(r.e(this.index))return this.heightBuffer[this.index];var i=this.first.getH(e,t),n=this.second.getH(e,t);return 0===t+i/z*e||0===t+n/z*e?0:p.e.lerp(this.first.getH(),this.second.getH(),this.ratio)},K.prototype.getU=function(){return r.e(this.index)?this.uBuffer[this.index]:p.e.lerp(this.first.getU(),this.second.getU(),this.ratio)},K.prototype.getV=function(){return r.e(this.index)?this.vBuffer[this.index]:p.e.lerp(this.first.getV(),this.second.getV(),this.ratio)};var Y=new i.o,_=-1,G=[new n.t,new n.t],J=[new n.t,new n.t];function Z(t,i){++_;var r=G[_],s=J[_];return r=e.t.octDecode(t.first.getNormalX(),t.first.getNormalY(),r),s=e.t.octDecode(t.second.getNormalX(),t.second.getNormalY(),s),E=n.t.lerp(r,s,t.ratio,E),n.t.normalize(E,E),e.t.octEncode(E,i),--_,i}K.prototype.getNormalX=function(){return r.e(this.index)?this.normalBuffer[2*this.index]:(Y=Z(this,Y)).x},K.prototype.getNormalY=function(){return r.e(this.index)?this.normalBuffer[2*this.index+1]:(Y=Z(this,Y)).y};var $=[];function j(e,t,i,n,s,h,u,o,p,d,a){if(0!==u.length){for(var f=0,l=0;l<u.length;)l=$[f++].initializeFromClipResult(u,l,o);for(var g=0;g<f;++g){var c=$[g];if(c.isIndexed())c.newIndex=h[c.index],c.uBuffer=e,c.vBuffer=t,c.heightBuffer=i,p&&(c.normalBuffer=n);else{var m=c.getKey();if(r.e(h[m]))c.newIndex=h[m];else{var x=e.length;e.push(c.getU()),t.push(c.getV()),i.push(c.getH(d,a)),p&&(n.push(c.getNormalX()),n.push(c.getNormalY())),c.newIndex=x,h[m]=x}}}3===f?(s.push($[0].newIndex),s.push($[1].newIndex),s.push($[2].newIndex)):4===f&&(s.push($[0].newIndex),s.push($[1].newIndex),s.push($[2].newIndex),s.push($[0].newIndex),s.push($[2].newIndex),s.push($[3].newIndex))}}return $.push(new K),$.push(new K),$.push(new K),$.push(new K),a((function(e,i){var o=e.isEastChild,a=e.isNorthChild,f=o?N:0,l=o?z:N,g=a?N:0,c=a?z:N,m=M,x=U,w=P,v=k;m.length=0,x.length=0,w.length=0,v.length=0;var y=F;y.length=0;var b={},B=e.vertices,I=e.indices;I=I.subarray(0,e.indexCountWithoutSkirts);var A,C,H,Y,_,G=h.h.clone(e.encoding),J=G.hasVertexNormals,Z=e.exaggeration,$=0,Q=e.vertexCountWithoutSkirts,ee=e.minimumHeight,te=e.maximumHeight,ie=r.e(e.validMinimumHeight)?e.validMinimumHeight:e.minimumHeight,ne=r.e(e.validMaximumHeight)?e.validMaximumHeight:e.maximumHeight,re=new Array(Q),se=new Array(Q),he=new Array(Q),ue=J?new Array(2*Q):void 0;for(C=0,H=0;C<Q;++C,H+=2){var oe=G.decodeTextureCoordinates(B,C,X);if(A=G.decodeHeight(B,C)/Z,Y=p.e.clamp(oe.x*z|0,0,z),_=p.e.clamp(oe.y*z|0,0,z),he[C]=p.e.clamp((A-ee)/(te-ee)*z|0,0,z),Y<20&&(Y=0),_<20&&(_=0),z-Y<20&&(Y=z),z-_<20&&(_=z),re[C]=Y,se[C]=_,J){var pe=G.getOctEncodedNormal(B,C,W);ue[H]=pe.x,ue[H+1]=pe.y}(o&&Y>=N||!o&&Y<=N)&&(a&&_>=N||!a&&_<=N)&&(b[C]=$,m.push(Y),x.push(_),w.push(he[C]),J&&(v.push(ue[H]),v.push(ue[H+1])),++$)}var de=[];de.push(new K),de.push(new K),de.push(new K);var ae,fe=[];for(fe.push(new K),fe.push(new K),fe.push(new K),C=0;C<I.length;C+=3){var le=I[C],ge=I[C+1],ce=I[C+2],me=re[le],xe=re[ge],we=re[ce];de[0].initializeIndexed(re,se,he,ue,le),de[1].initializeIndexed(re,se,he,ue,ge),de[2].initializeIndexed(re,se,he,ue,ce);var ve=T.clipTriangleAtAxisAlignedThreshold(N,o,me,xe,we,O);(ae=0)>=ve.length||((ae=fe[0].initializeFromClipResult(ve,ae,de))>=ve.length||(ae=fe[1].initializeFromClipResult(ve,ae,de))>=ve.length||(ae=fe[2].initializeFromClipResult(ve,ae,de),j(m,x,w,v,y,b,T.clipTriangleAtAxisAlignedThreshold(N,a,fe[0].getV(),fe[1].getV(),fe[2].getV(),V),fe,J,te,ee),ae<ve.length&&(fe[2].clone(fe[1]),fe[2].initializeFromClipResult(ve,ae,de),j(m,x,w,v,y,b,T.clipTriangleAtAxisAlignedThreshold(N,a,fe[0].getV(),fe[1].getV(),fe[2].getV(),V),fe,J,te,ee))))}var ye=o?-32767:0,be=a?-32767:0,Be=[],Ie=[],Ae=[],Ce=[],He=Number.MAX_VALUE,Te=-He,ze=Number.MAX_VALUE,Ne=-He,Oe=R;Oe.length=0;var Ve=s.t.clone(e.ellipsoid),Re=s.h.clone(e.childRectangle),qe=Re.north,Ee=Re.south,Me=Re.east,Ue=Re.west;for(Me<Ue&&(Me+=p.e.TWO_PI),C=0;C<m.length;++C){(Y=Math.round(m[C]))<=f?(Be.push(C),Y=0):Y>=l?(Ae.push(C),Y=z):Y=2*Y+ye,m[C]=Y,(_=Math.round(x[C]))<=g?(Ie.push(C),_=0):_>=c?(Ce.push(C),_=z):_=2*_+be,x[C]=_,(A=p.e.lerp(ee,te,w[C]/z))<He&&(He=A),A>Te&&(Te=A);var Pe=A;(Pe=p.e.clamp(Pe,ie,ne))<ze&&(ze=Pe),Pe>Ne&&(Ne=Pe),w[C]=A,q.longitude=p.e.lerp(Ue,Me,Y/z),q.latitude=p.e.lerp(Ee,qe,_/z),q.height=A,Ve.cartographicToCartesian(q,E),Oe.push(E.x),Oe.push(E.y),Oe.push(E.z)}var Fe=t.i.fromVertices(Oe,n.t.ZERO,3,L),ke=d.x.fromRectangle(Re,He,Te,Ve,S),De=d.x.fromRectangle(Re,ze,Ne,Ve,S),Le=new h.s(Ve).computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid(Fe.center,Oe,3,Fe.center,He,D),Se=Te-He,Xe=new Uint16Array(m.length+x.length+w.length);for(C=0;C<m.length;++C)Xe[C]=m[C];var We=m.length;for(C=0;C<x.length;++C)Xe[We+C]=x[C];for(We+=x.length,C=0;C<w.length;++C)Xe[We+C]=z*(w[C]-He)/Se;var Ke,Ye=u.IndexDatatype.createTypedArray(m.length,y);if(J){var _e=new Uint8Array(v);i.push(Xe.buffer,Ye.buffer,_e.buffer),Ke=_e.buffer}else i.push(Xe.buffer,Ye.buffer);return{vertices:Xe.buffer,encodedNormals:Ke,indices:Ye.buffer,minimumHeight:He,maximumHeight:Te,westIndices:Be,southIndices:Ie,eastIndices:Ae,northIndices:Ce,boundingSphere:Fe,orientedBoundingBox:ke,horizonOcclusionPoint:Le,validMinimumHeight:ze,validMaximumHeight:Ne,validOrientedBoundingBox:De}}))}));
