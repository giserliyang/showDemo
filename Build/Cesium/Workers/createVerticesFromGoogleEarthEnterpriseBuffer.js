define(["./EllipsoidTangentPlane-e12285fe","./buildModuleUrl-d920237a","./Cartesian2-2b41fabe","./Cartographic-1d953166","./when-d186add7","./Rectangle-f841217d","./TerrainEncoding-54acbe88","./Math-7f5f2992","./FeatureDetection-4281d393","./OrientedBoundingBox-9c607ea0","./RuntimeError-4a74cd1a","./GeometryAttribute-95780fd1","./WebMercatorProjection-af624514","./createTaskProcessorWorker","./Check-2514d21d","./Cartesian4-3408960c","./IntersectionTests-300d4352","./Plane-d9914d3c","./Event-50568704","./AttributeCompression-16430ee7","./ComponentDatatype-07894a2b","./WebGLConstants-8d1e45f7","./PolygonPipeline-6809c3ce","./EllipsoidRhumbLine-394d2834","./Buffer-455831f6","./IndexDatatype-61ffec74","./Color-2b4500b6","./BoundingRectangle-1d700ce8"],(function(e,t,n,i,r,a,o,u,s,d,c,h,l,g,m,p,v,I,f,E,T,N,x,b,S,y,w,P){"use strict";var R=Uint16Array.BYTES_PER_ELEMENT,B=Int32Array.BYTES_PER_ELEMENT,A=Uint32Array.BYTES_PER_ELEMENT,M=Float32Array.BYTES_PER_ELEMENT,C=Float64Array.BYTES_PER_ELEMENT;function _(e,t,n){n=r.u(n,u.e);for(var i=e.length,a=0;a<i;++a)if(n.equalsEpsilon(e[a],t,u.e.EPSILON12))return a;return-1}var F=new i.t$1,W=new i.t,U=new i.t,Y=new i.t,k=new s.y;function L(e,t,a,o,d,c,h,l,g,m){for(var p=h.length,v=0;v<p;++v){var I=h[v],f=I.cartographic,E=I.index,T=e.length,N=f.longitude,x=f.latitude;x=u.e.clamp(x,-u.e.PI_OVER_TWO,u.e.PI_OVER_TWO);var b=f.height-c.skirtHeight;c.hMin=Math.min(c.hMin,b),i.t$1.fromRadians(N,x,b,F),g&&(F.longitude+=l),g?v===p-1?F.latitude+=m:0===v&&(F.latitude-=m):F.latitude+=l;var S=c.ellipsoid.cartographicToCartesian(F);e.push(S),t.push(b),a.push(n.o.clone(a[E])),o.length>0&&o.push(o[E]),s.y.multiplyByPoint(c.toENU,S,W);var y=c.minimum,w=c.maximum;i.t.minimumByComponent(W,y,y),i.t.maximumByComponent(W,w,w);var P=c.lastBorderPoint;if(r.e(P)){var R=P.index;d.push(R,T-1,T,T,E,R)}c.lastBorderPoint=I}}return g((function(g,m){g.ellipsoid=a.t.clone(g.ellipsoid),g.rectangle=a.h.clone(g.rectangle);var p=function(a,g,m,p,v,I,f,E,T,N){var x,b,S,y,w,P;r.e(p)?(x=p.west,b=p.south,S=p.east,y=p.north,w=p.width,P=p.height):(x=u.e.toRadians(v.west),b=u.e.toRadians(v.south),S=u.e.toRadians(v.east),y=u.e.toRadians(v.north),w=u.e.toRadians(p.width),P=u.e.toRadians(p.height));var O,V,H=[b,y],$=[x,S],D=h.m.eastNorthUpToFixedFrame(g,m),G=s.y.inverseTransformation(D,k);E&&(O=l.t.geodeticLatitudeToMercatorAngle(b),V=1/(l.t.geodeticLatitudeToMercatorAngle(y)-O));var z=new DataView(a),j=Number.POSITIVE_INFINITY,q=Number.NEGATIVE_INFINITY,J=U;J.x=Number.POSITIVE_INFINITY,J.y=Number.POSITIVE_INFINITY,J.z=Number.POSITIVE_INFINITY;var K=Y;K.x=Number.NEGATIVE_INFINITY,K.y=Number.NEGATIVE_INFINITY,K.z=Number.NEGATIVE_INFINITY;var Q,X,Z=0,ee=0,te=0;for(X=0;X<4;++X){var ne=Z;Q=z.getUint32(ne,!0),ne+=A;var ie=u.e.toRadians(180*z.getFloat64(ne,!0));ne+=C,-1===_($,ie)&&$.push(ie);var re=u.e.toRadians(180*z.getFloat64(ne,!0));ne+=C,-1===_(H,re)&&H.push(re),ne+=2*C;var ae=z.getInt32(ne,!0);ne+=B,ee+=ae,te+=3*(ae=z.getInt32(ne,!0)),Z+=Q+A}var oe=[],ue=[],se=new Array(ee),de=new Array(ee),ce=new Array(ee),he=E?new Array(ee):[],le=new Array(te),ge=[],me=[],pe=[],ve=[],Ie=0,fe=0;for(Z=0,X=0;X<4;++X){Q=z.getUint32(Z,!0);var Ee=Z+=A,Te=u.e.toRadians(180*z.getFloat64(Z,!0));Z+=C;var Ne=u.e.toRadians(180*z.getFloat64(Z,!0));Z+=C;var xe=u.e.toRadians(180*z.getFloat64(Z,!0)),be=.5*xe;Z+=C;var Se=u.e.toRadians(180*z.getFloat64(Z,!0)),ye=.5*Se;Z+=C;var we=z.getInt32(Z,!0);Z+=B;var Pe=z.getInt32(Z,!0);Z+=B,Z+=B;for(var Re=new Array(we),Be=0;Be<we;++Be){var Ae=Te+z.getUint8(Z++)*xe;F.longitude=Ae;var Me=Ne+z.getUint8(Z++)*Se;F.latitude=Me;var Ce=z.getFloat32(Z,!0);if(Z+=M,0!==Ce&&Ce<N&&(Ce*=-Math.pow(2,T)),Ce*=6371010*I,F.height=Ce,-1!==_($,Ae)||-1!==_(H,Me)){var _e=_(oe,F,i.t$1);if(-1!==_e){Re[Be]=ue[_e];continue}oe.push(i.t$1.clone(F)),ue.push(Ie)}Re[Be]=Ie,Math.abs(Ae-x)<be?ge.push({index:Ie,cartographic:i.t$1.clone(F)}):Math.abs(Ae-S)<be?pe.push({index:Ie,cartographic:i.t$1.clone(F)}):Math.abs(Me-b)<ye?me.push({index:Ie,cartographic:i.t$1.clone(F)}):Math.abs(Me-y)<ye&&ve.push({index:Ie,cartographic:i.t$1.clone(F)}),j=Math.min(Ce,j),q=Math.max(Ce,q),ce[Ie]=Ce;var Fe=m.cartographicToCartesian(F);se[Ie]=Fe,E&&(he[Ie]=(l.t.geodeticLatitudeToMercatorAngle(Me)-O)*V),s.y.multiplyByPoint(G,Fe,W),i.t.minimumByComponent(W,J,J),i.t.maximumByComponent(W,K,K);var We=(Ae-x)/(S-x);We=u.e.clamp(We,0,1);var Ue=(Me-b)/(y-b);Ue=u.e.clamp(Ue,0,1),de[Ie]=new n.o(We,Ue),++Ie}for(var Ye=3*Pe,ke=0;ke<Ye;++ke,++fe)le[fe]=Re[z.getUint16(Z,!0)],Z+=R;if(Q!==Z-Ee)throw new c.t("Invalid terrain tile.")}se.length=Ie,de.length=Ie,ce.length=Ie,E&&(he.length=Ie);var Le=Ie,Oe=fe,Ve={hMin:j,lastBorderPoint:void 0,skirtHeight:f,toENU:G,ellipsoid:m,minimum:J,maximum:K};ge.sort((function(e,t){return t.cartographic.latitude-e.cartographic.latitude})),me.sort((function(e,t){return e.cartographic.longitude-t.cartographic.longitude})),pe.sort((function(e,t){return e.cartographic.latitude-t.cartographic.latitude})),ve.sort((function(e,t){return t.cartographic.longitude-e.cartographic.longitude}));var He=1e-5;if(L(se,ce,de,he,le,Ve,ge,-He*w,!0,-He*P),L(se,ce,de,he,le,Ve,me,-He*P,!1),L(se,ce,de,he,le,Ve,pe,He*w,!0,He*P),L(se,ce,de,he,le,Ve,ve,He*P,!1),ge.length>0&&ve.length>0){var $e=ge[0].index,De=Le,Ge=ve[ve.length-1].index,ze=se.length-1;le.push(Ge,ze,De,De,$e,Ge)}ee=se.length;var je,qe=t.i.fromPoints(se);r.e(p)&&(je=d.x.fromRectangle(p,j,q,m));for(var Je=new o.s(m).computeHorizonCullingPointPossiblyUnderEllipsoid(g,se,j),Ke=new e.e(J,K,g),Qe=new o.h(Ke,Ve.hMin,q,D,!1,E),Xe=new Float32Array(ee*Qe.getStride()),Ze=0,et=0;et<ee;++et)Ze=Qe.encode(Xe,Ze,se[et],de[et],ce[et],void 0,he[et]);var tt=ge.map((function(e){return e.index})).reverse(),nt=me.map((function(e){return e.index})).reverse(),it=pe.map((function(e){return e.index})).reverse(),rt=ve.map((function(e){return e.index})).reverse();return nt.unshift(it[it.length-1]),nt.push(tt[0]),rt.unshift(tt[tt.length-1]),rt.push(it[0]),{vertices:Xe,indices:new Uint16Array(le),maximumHeight:q,minimumHeight:j,encoding:Qe,boundingSphere3D:qe,orientedBoundingBox:je,occludeePointInScaledSpace:Je,vertexCountWithoutSkirts:Le,indexCountWithoutSkirts:Oe,westIndicesSouthToNorth:tt,southIndicesEastToWest:nt,eastIndicesNorthToSouth:it,northIndicesWestToEast:rt}}(g.buffer,g.relativeToCenter,g.ellipsoid,g.rectangle,g.nativeRectangle,g.exaggeration,g.skirtHeight,g.includeWebMercatorT,g.negativeAltitudeExponentBias,g.negativeElevationThreshold),v=p.vertices;m.push(v.buffer);var I=p.indices;return m.push(I.buffer),{vertices:v.buffer,indices:I.buffer,numberOfAttributes:p.encoding.getStride(),minimumHeight:p.minimumHeight,maximumHeight:p.maximumHeight,boundingSphere3D:p.boundingSphere3D,orientedBoundingBox:p.orientedBoundingBox,occludeePointInScaledSpace:p.occludeePointInScaledSpace,encoding:p.encoding,vertexCountWithoutSkirts:p.vertexCountWithoutSkirts,indexCountWithoutSkirts:p.indexCountWithoutSkirts,westIndicesSouthToNorth:p.westIndicesSouthToNorth,southIndicesEastToWest:p.southIndicesEastToWest,eastIndicesNorthToSouth:p.eastIndicesNorthToSouth,northIndicesWestToEast:p.northIndicesWestToEast}}))}));
