define(["./AttributeCompression-16430ee7","./Cartographic-1d953166","./Color-2b4500b6","./when-d186add7","./Rectangle-f841217d","./IndexDatatype-61ffec74","./Math-7f5f2992","./OrientedBoundingBox-9c607ea0","./createTaskProcessorWorker","./Cartesian2-2b41fabe","./Check-2514d21d","./FeatureDetection-4281d393","./Cartesian4-3408960c","./RuntimeError-4a74cd1a","./WebGLConstants-8d1e45f7","./buildModuleUrl-d920237a","./Event-50568704","./EllipsoidTangentPlane-e12285fe","./IntersectionTests-300d4352","./Plane-d9914d3c","./GeometryAttribute-95780fd1","./PolygonPipeline-6809c3ce","./ComponentDatatype-07894a2b","./EllipsoidRhumbLine-394d2834","./Buffer-455831f6","./BoundingRectangle-1d700ce8"],(function(e,t,r,n,a,o,i,f,d,s,c,u,h,l,p,g,b,y,v,I,m,w,x,A,N,k){"use strict";var E=new t.t,T=new a.t,L=new a.h,C={min:void 0,max:void 0,indexBytesPerElement:void 0};function P(e,t,n){var a=t.length,o=2+a*f.x.packedLength+1+function(e){for(var t=e.length,n=0,a=0;a<t;++a)n+=r.e.packedLength+3+e[a].batchIds.length;return n}(n),i=new Float64Array(o),d=0;i[d++]=e,i[d++]=a;for(var s=0;s<a;++s)f.x.pack(t[s],i,d),d+=f.x.packedLength;var c=n.length;i[d++]=c;for(var u=0;u<c;++u){var h=n[u];r.e.pack(h.color,i,d),d+=r.e.packedLength,i[d++]=h.offset,i[d++]=h.count;var l=h.batchIds,p=l.length;i[d++]=p;for(var g=0;g<p;++g)i[d++]=l[g]}return i}var U=new t.t,B=new t.t,O=new t.t,F=new t.t,D=new t.t,S=new t.t$1,R=new a.h;return d((function(d,s){var c;!function(e){var r=new Float64Array(e),n=0;C.indexBytesPerElement=r[n++],C.min=r[n++],C.max=r[n++],t.t.unpack(r,n,E),n+=t.t.packedLength,a.t.unpack(r,n,T),n+=a.t.packedLength,a.h.unpack(r,n,L)}(d.packedBuffer),c=2===C.indexBytesPerElement?new Uint16Array(d.indices):new Uint32Array(d.indices);var u,h,l,p=new Uint16Array(d.positions),g=new Uint32Array(d.counts),b=new Uint32Array(d.indexCounts),y=new Uint32Array(d.batchIds),v=new Uint32Array(d.batchTableColors),I=new Array(g.length),m=E,w=T,x=L,A=C.min,N=C.max,k=d.minimumHeights,_=d.maximumHeights;n.e(k)&&n.e(_)&&(k=new Float32Array(k),_=new Float32Array(_));var G=p.length/2,M=p.subarray(0,G),Y=p.subarray(G,2*G);e.t.zigZagDeltaDecode(M,Y);var V=new Float32Array(3*G);for(u=0;u<G;++u){var H=M[u],W=Y[u],$=i.e.lerp(x.west,x.east,H/32767),z=i.e.lerp(x.south,x.north,W/32767),Z=t.t$1.fromRadians($,z,0,S),j=w.cartographicToCartesian(Z,U);t.t.pack(j,V,3*u)}var q=g.length,J=new Array(q),K=new Array(q),Q=0,X=0;for(u=0;u<q;++u)J[u]=Q,K[u]=X,Q+=g[u],X+=b[u];var ee,te=new Float32Array(3*G*2),re=new Uint16Array(2*G),ne=new Uint32Array(K.length),ae=new Uint32Array(b.length),oe=[],ie={};for(u=0;u<q;++u)l=v[u],n.e(ie[l])?(ie[l].positionLength+=g[u],ie[l].indexLength+=b[u],ie[l].batchIds.push(u)):ie[l]={positionLength:g[u],indexLength:b[u],offset:0,indexOffset:0,batchIds:[u]};var fe=0,de=0;for(l in ie)if(ie.hasOwnProperty(l)){(ee=ie[l]).offset=fe,ee.indexOffset=de;var se=2*ee.positionLength,ce=2*ee.indexLength+6*ee.positionLength;fe+=se,de+=ce,ee.indexLength=ce}var ue=[];for(l in ie)ie.hasOwnProperty(l)&&(ee=ie[l],ue.push({color:r.e.fromRgba(parseInt(l)),offset:ee.indexOffset,count:ee.indexLength,batchIds:ee.batchIds}));for(u=0;u<q;++u){var he=(ee=ie[l=v[u]]).offset,le=3*he,pe=he,ge=J[u],be=g[u],ye=y[u],ve=A,Ie=N;n.e(k)&&n.e(_)&&(ve=k[u],Ie=_[u]);var me=Number.POSITIVE_INFINITY,we=Number.NEGATIVE_INFINITY,xe=Number.POSITIVE_INFINITY,Ae=Number.NEGATIVE_INFINITY;for(h=0;h<be;++h){var Ne=t.t.unpack(V,3*ge+3*h,U);w.scaleToGeodeticSurface(Ne,Ne);var ke=w.cartesianToCartographic(Ne,S),Ee=ke.latitude,Te=ke.longitude;me=Math.min(Ee,me),we=Math.max(Ee,we),xe=Math.min(Te,xe),Ae=Math.max(Te,Ae);var Le=w.geodeticSurfaceNormal(Ne,B),Ce=t.t.multiplyByScalar(Le,ve,O),Pe=t.t.add(Ne,Ce,F);Ce=t.t.multiplyByScalar(Le,Ie,Ce);var Ue=t.t.add(Ne,Ce,D);t.t.subtract(Ue,m,Ue),t.t.subtract(Pe,m,Pe),t.t.pack(Ue,te,le),t.t.pack(Pe,te,le+3),re[pe]=ye,re[pe+1]=ye,le+=6,pe+=2}(x=R).west=xe,x.east=Ae,x.south=me,x.north=we,I[u]=f.x.fromRectangle(x,A,N,w);var Be=ee.indexOffset,Oe=K[u],Fe=b[u];for(ne[u]=Be,h=0;h<Fe;h+=3){var De=c[Oe+h]-ge,Se=c[Oe+h+1]-ge,Re=c[Oe+h+2]-ge;oe[Be++]=2*De+he,oe[Be++]=2*Se+he,oe[Be++]=2*Re+he,oe[Be++]=2*Re+1+he,oe[Be++]=2*Se+1+he,oe[Be++]=2*De+1+he}for(h=0;h<be;++h){var _e=h,Ge=(h+1)%be;oe[Be++]=2*_e+1+he,oe[Be++]=2*Ge+he,oe[Be++]=2*_e+he,oe[Be++]=2*_e+1+he,oe[Be++]=2*Ge+1+he,oe[Be++]=2*Ge+he}ee.offset+=2*be,ee.indexOffset=Be,ae[u]=Be-ne[u]}oe=o.IndexDatatype.createTypedArray(te.length/3,oe);for(var Me=ue.length,Ye=0;Ye<Me;++Ye){for(var Ve=ue[Ye].batchIds,He=0,We=Ve.length,$e=0;$e<We;++$e)He+=ae[Ve[$e]];ue[Ye].count=He}var ze=P(2===oe.BYTES_PER_ELEMENT?o.IndexDatatype.UNSIGNED_SHORT:o.IndexDatatype.UNSIGNED_INT,I,ue);return s.push(te.buffer,oe.buffer,ne.buffer,ae.buffer,re.buffer,ze.buffer),{positions:te.buffer,indices:oe.buffer,indexOffsets:ne.buffer,indexCounts:ae.buffer,batchIds:re.buffer,packedBuffer:ze.buffer}}))}));
