define(["./when-d186add7","./Rectangle-f841217d","./arrayFill-deb10550","./buildModuleUrl-d920237a","./Cartesian2-2b41fabe","./Cartographic-1d953166","./Check-2514d21d","./ComponentDatatype-07894a2b","./GeometryAttribute-95780fd1","./GeometryAttributes-9c67dd14","./GeometryInstance-2076821b","./GeometryOffsetAttribute-da5a1d35","./GeometryPipeline-6f0b08bc","./IndexDatatype-61ffec74","./Math-7f5f2992","./FeatureDetection-4281d393","./PolygonPipeline-6809c3ce","./RectangleGeometryLibrary-b81eedac","./VertexFormat-769ac289","./Event-50568704","./RuntimeError-4a74cd1a","./WebGLConstants-8d1e45f7","./Cartesian4-3408960c","./AttributeCompression-16430ee7","./EncodedCartesian3-e527b85b","./IntersectionTests-300d4352","./Plane-d9914d3c","./EllipsoidRhumbLine-394d2834"],(function(t,e,a,n,o,r,i,s,u,l,c,p,d,g,h,m,v,f,y,_,b,w,A,x,E,D,F,P){"use strict";var R=new r.t,L=new r.t,T=new r.t,C=new r.t,O=new e.h,N=new o.o,I=new n.i,k=new n.i;function S(t,e){var a=new u.I({attributes:new l.a,primitiveType:m._0x12cc5d.TRIANGLES});return a.attributes.position=new u.o({componentDatatype:s.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:e.positions}),t.normal&&(a.attributes.normal=new u.o({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:e.normals})),t.tangent&&(a.attributes.tangent=new u.o({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:e.tangents})),t.bitangent&&(a.attributes.bitangent=new u.o({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:e.bitangents})),a}var z=new r.t,G=new r.t;function M(t,e){var a=t._vertexFormat,n=t._ellipsoid,o=e.height,i=e.width,l=e.northCap,c=e.southCap,p=0,d=o,h=o,v=0;l&&(p=1,h-=1,v+=1),c&&(d-=1,h-=1,v+=1),v+=i*h;for(var y=a.position?new Float64Array(3*v):void 0,_=a.st?new Float32Array(2*v):void 0,b=0,w=0,A=R,x=N,E=Number.MAX_VALUE,D=Number.MAX_VALUE,F=-Number.MAX_VALUE,P=-Number.MAX_VALUE,O=p;O<d;++O)for(var I=0;I<i;++I)f.j.computePosition(e,n,a.st,O,I,A,x),y[b++]=A.x,y[b++]=A.y,y[b++]=A.z,a.st&&(_[w++]=x.x,_[w++]=x.y,E=Math.min(E,x.x),D=Math.min(D,x.y),F=Math.max(F,x.x),P=Math.max(P,x.y));if(l&&(f.j.computePosition(e,n,a.st,0,0,A,x),y[b++]=A.x,y[b++]=A.y,y[b++]=A.z,a.st&&(_[w++]=x.x,_[w++]=x.y,E=x.x,D=x.y,F=x.x,P=x.y)),c&&(f.j.computePosition(e,n,a.st,o-1,0,A,x),y[b++]=A.x,y[b++]=A.y,y[b]=A.z,a.st&&(_[w++]=x.x,_[w]=x.y,E=Math.min(E,x.x),D=Math.min(D,x.y),F=Math.max(F,x.x),P=Math.max(P,x.y))),a.st&&(E<0||D<0||F>1||P>1))for(var k=0;k<_.length;k+=2)_[k]=(_[k]-E)/(F-E),_[k+1]=(_[k+1]-D)/(P-D);var z=function(t,e,a,n){var o=t.length,i=e.normal?new Float32Array(o):void 0,s=e.tangent?new Float32Array(o):void 0,u=e.bitangent?new Float32Array(o):void 0,l=0,c=C,p=T,d=L;if(e.normal||e.tangent||e.bitangent)for(var g=0;g<o;g+=3){var h=r.t.fromArray(t,g,R),v=l+1,f=l+2;d=a.geodeticSurfaceNormal(h,d),(e.tangent||e.bitangent)&&(r.t.cross(r.t.UNIT_Z,d,p),m.p.multiplyByVector(n,p,p),r.t.normalize(p,p),e.bitangent&&r.t.normalize(r.t.cross(d,p,c),c)),e.normal&&(i[l]=d.x,i[v]=d.y,i[f]=d.z),e.tangent&&(s[l]=p.x,s[v]=p.y,s[f]=p.z),e.bitangent&&(u[l]=c.x,u[v]=c.y,u[f]=c.z),l+=3}return S(e,{positions:t,normals:i,tangents:s,bitangents:u})}(y,a,n,e.tangentRotationMatrix),G=6*(i-1)*(h-1);l&&(G+=3*(i-1)),c&&(G+=3*(i-1));var M,H=g.IndexDatatype.createTypedArray(v,G),V=0,U=0;for(M=0;M<h-1;++M){for(var j=0;j<i-1;++j){var B=V,q=B+i,Y=q+1,X=B+1;H[U++]=B,H[U++]=q,H[U++]=X,H[U++]=X,H[U++]=q,H[U++]=Y,++V}++V}if(l||c){var $,W,J=v-1,Q=v-1;if(l&&c&&(J=v-2),V=0,l)for(M=0;M<i-1;M++)W=($=V)+1,H[U++]=J,H[U++]=$,H[U++]=W,++V;if(c)for(V=(h-1)*i,M=0;M<i-1;M++)W=($=V)+1,H[U++]=$,H[U++]=Q,H[U++]=W,++V}return z.indices=H,a.st&&(z.attributes.st=new u.o({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:_})),z}function H(t,e,a,n,o){return t[e++]=n[a],t[e++]=n[a+1],t[e++]=n[a+2],t[e++]=o[a],t[e++]=o[a+1],t[e]=o[a+2],t}function V(t,e,a,n){return t[e++]=n[a],t[e++]=n[a+1],t[e++]=n[a],t[e]=n[a+1],t}var U=new y.n;function j(e,n){var o,i=e._shadowVolume,l=e._offsetAttribute,m=e._vertexFormat,f=e._extrudedHeight,_=e._surfaceHeight,b=e._ellipsoid,w=n.height,A=n.width;if(i){var x=y.n.clone(m,U);x.normal=!0,e._vertexFormat=x}var E=M(e,n);i&&(e._vertexFormat=m);var D=v.A.scaleToGeodeticHeight(E.attributes.position.values,_,b,!1),F=(D=new Float64Array(D)).length,P=2*F,O=new Float64Array(P);O.set(D);var N=v.A.scaleToGeodeticHeight(E.attributes.position.values,f,b);O.set(N,F),E.attributes.position.values=O;var I,k,j=m.normal?new Float32Array(P):void 0,B=m.tangent?new Float32Array(P):void 0,q=m.bitangent?new Float32Array(P):void 0,Y=m.st?new Float32Array(P/3*2):void 0;if(m.normal){for(k=E.attributes.normal.values,j.set(k),o=0;o<F;o++)k[o]=-k[o];j.set(k,F),E.attributes.normal.values=j}if(i){k=E.attributes.normal.values,m.normal||(E.attributes.normal=void 0);var X=new Float32Array(P);for(o=0;o<F;o++)k[o]=-k[o];X.set(k,F),E.attributes.extrudeDirection=new u.o({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:X})}var $,W=t.e(l);if(W){var J=F/3*2,Q=new Uint8Array(J);l===p.z.TOP?Q=a.d(Q,1,0,J/2):($=l===p.z.NONE?0:1,Q=a.d(Q,$)),E.attributes.applyOffset=new u.o({componentDatatype:s.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:Q})}if(m.tangent){var Z=E.attributes.tangent.values;for(B.set(Z),o=0;o<F;o++)Z[o]=-Z[o];B.set(Z,F),E.attributes.tangent.values=B}if(m.bitangent){var K=E.attributes.bitangent.values;q.set(K),q.set(K,F),E.attributes.bitangent.values=q}m.st&&(I=E.attributes.st.values,Y.set(I),Y.set(I,F/3*2),E.attributes.st.values=Y);var tt=E.indices,et=tt.length,at=F/3,nt=g.IndexDatatype.createTypedArray(P/3,2*et);for(nt.set(tt),o=0;o<et;o+=3)nt[o+et]=tt[o+2]+at,nt[o+1+et]=tt[o+1]+at,nt[o+2+et]=tt[o]+at;E.indices=nt;var ot=n.northCap,rt=n.southCap,it=w,st=2,ut=0,lt=4,ct=4;ot&&(st-=1,it-=1,ut+=1,lt-=2,ct-=1),rt&&(st-=1,it-=1,ut+=1,lt-=2,ct-=1);var pt=2*((ut+=st*A+2*it-lt)+ct),dt=new Float64Array(3*pt),gt=i?new Float32Array(3*pt):void 0,ht=W?new Uint8Array(pt):void 0,mt=m.st?new Float32Array(2*pt):void 0,vt=l===p.z.TOP;W&&!vt&&($=l===p.z.ALL?1:0,ht=a.d(ht,$));var ft,yt=0,_t=0,bt=0,wt=0,At=A*it;for(o=0;o<At;o+=A)dt=H(dt,yt,ft=3*o,D,N),yt+=6,m.st&&(mt=V(mt,_t,2*o,I),_t+=4),i&&(bt+=3,gt[bt++]=k[ft],gt[bt++]=k[ft+1],gt[bt++]=k[ft+2]),vt&&(ht[wt++]=1,wt+=1);if(rt){var xt=ot?At+1:At;for(ft=3*xt,o=0;o<2;o++)dt=H(dt,yt,ft,D,N),yt+=6,m.st&&(mt=V(mt,_t,2*xt,I),_t+=4),i&&(bt+=3,gt[bt++]=k[ft],gt[bt++]=k[ft+1],gt[bt++]=k[ft+2]),vt&&(ht[wt++]=1,wt+=1)}else for(o=At-A;o<At;o++)dt=H(dt,yt,ft=3*o,D,N),yt+=6,m.st&&(mt=V(mt,_t,2*o,I),_t+=4),i&&(bt+=3,gt[bt++]=k[ft],gt[bt++]=k[ft+1],gt[bt++]=k[ft+2]),vt&&(ht[wt++]=1,wt+=1);for(o=At-1;o>0;o-=A)dt=H(dt,yt,ft=3*o,D,N),yt+=6,m.st&&(mt=V(mt,_t,2*o,I),_t+=4),i&&(bt+=3,gt[bt++]=k[ft],gt[bt++]=k[ft+1],gt[bt++]=k[ft+2]),vt&&(ht[wt++]=1,wt+=1);if(ot){var Et=At;for(ft=3*Et,o=0;o<2;o++)dt=H(dt,yt,ft,D,N),yt+=6,m.st&&(mt=V(mt,_t,2*Et,I),_t+=4),i&&(bt+=3,gt[bt++]=k[ft],gt[bt++]=k[ft+1],gt[bt++]=k[ft+2]),vt&&(ht[wt++]=1,wt+=1)}else for(o=A-1;o>=0;o--)dt=H(dt,yt,ft=3*o,D,N),yt+=6,m.st&&(mt=V(mt,_t,2*o,I),_t+=4),i&&(bt+=3,gt[bt++]=k[ft],gt[bt++]=k[ft+1],gt[bt++]=k[ft+2]),vt&&(ht[wt++]=1,wt+=1);var Dt=function(t,e,a){var n=t.length,o=e.normal?new Float32Array(n):void 0,i=e.tangent?new Float32Array(n):void 0,s=e.bitangent?new Float32Array(n):void 0,u=0,l=0,c=0,p=!0,d=C,g=T,m=L;if(e.normal||e.tangent||e.bitangent)for(var v=0;v<n;v+=6){var f=r.t.fromArray(t,v,R),y=r.t.fromArray(t,(v+6)%n,z);if(p){var _=r.t.fromArray(t,(v+3)%n,G);r.t.subtract(y,f,y),r.t.subtract(_,f,_),m=r.t.normalize(r.t.cross(_,y,m),m),p=!1}r.t.equalsEpsilon(y,f,h.e.EPSILON10)&&(p=!0),(e.tangent||e.bitangent)&&(d=a.geodeticSurfaceNormal(f,d),e.tangent&&(g=r.t.normalize(r.t.cross(d,m,g),g))),e.normal&&(o[u++]=m.x,o[u++]=m.y,o[u++]=m.z,o[u++]=m.x,o[u++]=m.y,o[u++]=m.z),e.tangent&&(i[l++]=g.x,i[l++]=g.y,i[l++]=g.z,i[l++]=g.x,i[l++]=g.y,i[l++]=g.z),e.bitangent&&(s[c++]=d.x,s[c++]=d.y,s[c++]=d.z,s[c++]=d.x,s[c++]=d.y,s[c++]=d.z)}return S(e,{positions:t,normals:o,tangents:i,bitangents:s})}(dt,m,b);m.st&&(Dt.attributes.st=new u.o({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:mt})),i&&(Dt.attributes.extrudeDirection=new u.o({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:gt})),W&&(Dt.attributes.applyOffset=new u.o({componentDatatype:s.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:ht}));var Ft,Pt,Rt,Lt,Tt=g.IndexDatatype.createTypedArray(pt,6*ut);F=dt.length/3;var Ct=0;for(o=0;o<F-1;o+=2){Lt=((Ft=o)+2)%F;var Ot=r.t.fromArray(dt,3*Ft,z),Nt=r.t.fromArray(dt,3*Lt,G);r.t.equalsEpsilon(Ot,Nt,h.e.EPSILON10)||(Rt=((Pt=(Ft+1)%F)+2)%F,Tt[Ct++]=Ft,Tt[Ct++]=Pt,Tt[Ct++]=Lt,Tt[Ct++]=Lt,Tt[Ct++]=Pt,Tt[Ct++]=Rt)}return Dt.indices=Tt,(Dt=d.k.combineInstances([new c.d({geometry:E}),new c.d({geometry:Dt})]))[0]}var B=[new r.t,new r.t,new r.t,new r.t],q=new r.t$1,Y=new r.t$1;function X(t,a,n,o,r){if(0===n)return e.h.clone(t,r);var i=f.j.computeOptions(t,a,n,0,O,q),s=i.height,u=i.width,l=B;return f.j.computePosition(i,o,!1,0,0,l[0]),f.j.computePosition(i,o,!1,0,u-1,l[1]),f.j.computePosition(i,o,!1,s-1,0,l[2]),f.j.computePosition(i,o,!1,s-1,u-1,l[3]),e.h.fromCartesianArray(l,o,r)}function $(a){var n=(a=t.u(a,t.u.EMPTY_OBJECT)).rectangle;if(i.o.typeOf.object("rectangle",n),e.h.validate(n),n.north<n.south)throw new i.t("options.rectangle.north must be greater than or equal to options.rectangle.south");var o=t.u(a.height,0),r=t.u(a.extrudedHeight,o);this._rectangle=e.h.clone(n),this._granularity=t.u(a.granularity,h.e.RADIANS_PER_DEGREE),this._ellipsoid=e.t.clone(t.u(a.ellipsoid,e.t.WGS84)),this._surfaceHeight=Math.max(o,r),this._rotation=t.u(a.rotation,0),this._stRotation=t.u(a.stRotation,0),this._vertexFormat=y.n.clone(t.u(a.vertexFormat,y.n.DEFAULT)),this._extrudedHeight=Math.min(o,r),this._shadowVolume=t.u(a.shadowVolume,!1),this._workerName="createRectangleGeometry",this._offsetAttribute=a.offsetAttribute,this._rotatedRectangle=void 0,this._textureCoordinateRotationPoints=void 0}$.packedLength=e.h.packedLength+e.t.packedLength+y.n.packedLength+7,$.pack=function(a,n,o){return i.o.typeOf.object("value",a),i.o.defined("array",n),o=t.u(o,0),e.h.pack(a._rectangle,n,o),o+=e.h.packedLength,e.t.pack(a._ellipsoid,n,o),o+=e.t.packedLength,y.n.pack(a._vertexFormat,n,o),o+=y.n.packedLength,n[o++]=a._granularity,n[o++]=a._surfaceHeight,n[o++]=a._rotation,n[o++]=a._stRotation,n[o++]=a._extrudedHeight,n[o++]=a._shadowVolume?1:0,n[o]=t.u(a._offsetAttribute,-1),n};var W=new e.h,J=e.t.clone(e.t.UNIT_SPHERE),Q={rectangle:W,ellipsoid:J,vertexFormat:U,granularity:void 0,height:void 0,rotation:void 0,stRotation:void 0,extrudedHeight:void 0,shadowVolume:void 0,offsetAttribute:void 0};$.unpack=function(a,n,o){i.o.defined("array",a),n=t.u(n,0);var r=e.h.unpack(a,n,W);n+=e.h.packedLength;var s=e.t.unpack(a,n,J);n+=e.t.packedLength;var u=y.n.unpack(a,n,U);n+=y.n.packedLength;var l=a[n++],c=a[n++],p=a[n++],d=a[n++],g=a[n++],h=1===a[n++],m=a[n];return t.e(o)?(o._rectangle=e.h.clone(r,o._rectangle),o._ellipsoid=e.t.clone(s,o._ellipsoid),o._vertexFormat=y.n.clone(u,o._vertexFormat),o._granularity=l,o._surfaceHeight=c,o._rotation=p,o._stRotation=d,o._extrudedHeight=g,o._shadowVolume=h,o._offsetAttribute=-1===m?void 0:m,o):(Q.granularity=l,Q.height=c,Q.rotation=p,Q.stRotation=d,Q.extrudedHeight=g,Q.shadowVolume=h,Q.offsetAttribute=-1===m?void 0:m,new $(Q))},$.computeRectangle=function(a,n){var o=(a=t.u(a,t.u.EMPTY_OBJECT)).rectangle;if(i.o.typeOf.object("rectangle",o),e.h.validate(o),o.north<o.south)throw new i.t("options.rectangle.north must be greater than or equal to options.rectangle.south");var r=t.u(a.granularity,h.e.RADIANS_PER_DEGREE),s=t.u(a.ellipsoid,e.t.WGS84);return X(o,r,t.u(a.rotation,0),s,n)};var Z=new m.p,K=new u.n,tt=new r.t$1;$.createGeometry=function(o){if(!h.e.equalsEpsilon(o._rectangle.north,o._rectangle.south,h.e.EPSILON10)&&!h.e.equalsEpsilon(o._rectangle.east,o._rectangle.west,h.e.EPSILON10)){var r=o._rectangle,i=o._ellipsoid,l=o._rotation,c=o._stRotation,d=o._vertexFormat,g=f.j.computeOptions(r,o._granularity,l,c,O,q,Y),y=Z;if(0!==c||0!==l){var _=e.h.center(r,tt),b=i.geodeticSurfaceNormalCartographic(_,z);u.n.fromAxisAngle(b,-c,K),m.p.fromQuaternion(K,y)}else m.p.clone(m.p.IDENTITY,y);var w,A,x=o._surfaceHeight,E=o._extrudedHeight,D=!h.e.equalsEpsilon(x,E,0,h.e.EPSILON2);if(g.lonScalar=1/o._rectangle.width,g.latScalar=1/o._rectangle.height,g.tangentRotationMatrix=y,r=o._rectangle,D){w=j(o,g);var F=n.i.fromRectangle3D(r,i,x,k),P=n.i.fromRectangle3D(r,i,E,I);A=n.i.union(F,P)}else{if((w=M(o,g)).attributes.position.values=v.A.scaleToGeodeticHeight(w.attributes.position.values,x,i,!1),t.e(o._offsetAttribute)){var R=w.attributes.position.values.length,L=new Uint8Array(R/3),T=o._offsetAttribute===p.z.NONE?0:1;a.d(L,T),w.attributes.applyOffset=new u.o({componentDatatype:s.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:L})}A=n.i.fromRectangle3D(r,i,x)}return d.position||delete w.attributes.position,new u.I({attributes:w.attributes,indices:w.indices,primitiveType:w.primitiveType,boundingSphere:A,offsetAttribute:o._offsetAttribute})}},$.createShadowVolume=function(t,e,a){var n=t._granularity,o=t._ellipsoid,r=e(n,o),i=a(n,o);return new $({rectangle:t._rectangle,rotation:t._rotation,ellipsoid:o,stRotation:t._stRotation,granularity:n,extrudedHeight:i,height:r,vertexFormat:y.n.POSITION_ONLY,shadowVolume:!0})};var et=new e.h,at=[new o.o,new o.o,new o.o],nt=new u.f,ot=new r.t$1;return Object.defineProperties($.prototype,{rectangle:{get:function(){return t.e(this._rotatedRectangle)||(this._rotatedRectangle=X(this._rectangle,this._granularity,this._rotation,this._ellipsoid)),this._rotatedRectangle}},textureCoordinateRotationPoints:{get:function(){return t.e(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(t){if(0===t._stRotation)return[0,0,0,1,1,0];var a=e.h.clone(t._rectangle,et),n=t._granularity,r=t._ellipsoid,i=X(a,n,t._rotation-t._stRotation,r,et),s=at;s[0].x=i.west,s[0].y=i.south,s[1].x=i.west,s[1].y=i.north,s[2].x=i.east,s[2].y=i.south;for(var l=t.rectangle,c=u.f.fromRotation(t._stRotation,nt),p=e.h.center(l,ot),d=0;d<3;++d){var g=s[d];g.x-=p.longitude,g.y-=p.latitude,u.f.multiplyByVector(c,g,g),g.x+=p.longitude,g.y+=p.latitude,g.x=(g.x-l.west)/l.width,g.y=(g.y-l.south)/l.height}var h=s[0],m=s[1],v=s[2],f=new Array(6);return o.o.pack(h,f),o.o.pack(m,f,2),o.o.pack(v,f,4),f}(this)),this._textureCoordinateRotationPoints}}}),function(a,n){return t.e(n)&&(a=$.unpack(a,n)),a._ellipsoid=e.t.clone(a._ellipsoid),a._rectangle=e.h.clone(a._rectangle),$.createGeometry(a)}}));
